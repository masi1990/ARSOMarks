"use strict";(self.webpackChunkarsomarks_frontend=self.webpackChunkarsomarks_frontend||[]).push([[242],{9242:(Y,m,a)=>{a.r(m),a.d(m,{MarkLicenseModificationModule:()=>S});var c=a(177),r=a(9417),l=a(1377),f=a(980),e=a(540),u=a(1626),g=a(5312);let b=(()=>{class i{constructor(t){this.http=t,this.baseUrl=`${g.c.apiBase}/mark-licenses/modifications`}requestModification(t){return this.http.post(this.baseUrl,t)}getModificationById(t){return this.http.get(`${this.baseUrl}/${t}`)}approveModification(t,o,s){return this.http.post(`${this.baseUrl}/${t}/approve`,{implementedChanges:o,notes:s})}rejectModification(t,o){return this.http.post(`${this.baseUrl}/${t}/reject`,{rejectionReason:o})}getModificationHistory(t){const o=(new u.Nl).set("licenseId",t);return this.http.get(this.baseUrl,{params:o})}static{this.\u0275fac=function(o){return new(o||i)(e.KVO(u.Qq))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var h=a(4699);function x(i,n){if(1&i&&(e.j41(0,"p",11),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(1),e.SpI("License: ",t.agreement.agreementId,"")}}function _(i,n){if(1&i&&(e.j41(0,"div",12)(1,"span",13),e.EFF(2),e.k0s()()),2&i){const t=e.XpG();e.R7$(1),e.Y8G("ngClass",t.getStatusBadgeClass(t.existingModification.status)),e.R7$(1),e.SpI(" ",t.existingModification.status," ")}}function v(i,n){if(1&i&&(e.j41(0,"div",14)(1,"p",15),e.EFF(2),e.k0s()()),2&i){const t=e.XpG();e.R7$(2),e.JRh(t.successMessage)}}function F(i,n){if(1&i&&(e.j41(0,"div",16),e.EFF(1),e.k0s()),2&i){const t=e.XpG();e.R7$(1),e.SpI(" ",t.error," ")}}function k(i,n){if(1&i&&(e.j41(0,"div",44)(1,"h3",45),e.EFF(2,"Current License Information"),e.k0s(),e.j41(3,"div",46)(4,"div")(5,"span",15),e.EFF(6,"Agreement ID:"),e.k0s(),e.EFF(7),e.k0s(),e.j41(8,"div")(9,"span",15),e.EFF(10,"License Type:"),e.k0s(),e.EFF(11),e.k0s(),e.j41(12,"div")(13,"span",15),e.EFF(14,"Start Date:"),e.k0s(),e.EFF(15),e.k0s(),e.j41(16,"div")(17,"span",15),e.EFF(18,"End Date:"),e.k0s(),e.EFF(19),e.k0s()()()),2&i){const t=e.XpG(2);e.R7$(7),e.SpI(" ",t.agreement.agreementId," "),e.R7$(4),e.SpI(" ",t.agreement.licenseTypeDisplay," "),e.R7$(4),e.SpI(" ",t.formatDate(t.agreement.licenseStartDate)," "),e.R7$(4),e.SpI(" ",t.formatDate(t.agreement.licenseEndDate)," ")}}function M(i,n){if(1&i&&(e.j41(0,"label",47),e.nrm(1,"input",48),e.j41(2,"span",49),e.EFF(3),e.k0s()()),2&i){const t=n.$implicit;e.R7$(1),e.Y8G("value",t.value),e.R7$(2),e.JRh(t.label)}}function E(i,n){1&i&&(e.j41(0,"p",50),e.EFF(1," At least one modification type must be selected "),e.k0s())}function j(i,n){if(1&i&&(e.j41(0,"option",51),e.EFF(1),e.k0s()),2&i){const t=n.$implicit;e.Y8G("value",t.value),e.R7$(1),e.JRh(t.label)}}function I(i,n){if(1&i){const t=e.RV6();e.j41(0,"div",52)(1,"span",49),e.EFF(2),e.k0s(),e.j41(3,"button",53),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.removeJustificationFile())}),e.EFF(4,"Remove"),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(2),e.JRh(t.justificationFile.name)}}function R(i,n){if(1&i&&(e.j41(0,"div")(1,"span",15),e.EFF(2,"Reviewed At:"),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(3);e.R7$(3),e.SpI(" ",t.formatDate(t.existingModification.reviewedAt)," ")}}function y(i,n){if(1&i&&(e.j41(0,"div",59)(1,"p",60),e.EFF(2,"Rejection Reason:"),e.k0s(),e.j41(3,"p",61),e.EFF(4),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(4),e.JRh(t.existingModification.rejectionReason)}}function C(i,n){if(1&i&&(e.j41(0,"div",62)(1,"p",63),e.EFF(2,"Implemented Changes:"),e.k0s(),e.j41(3,"pre",64),e.EFF(4),e.nI1(5,"json"),e.k0s()()),2&i){const t=e.XpG(3);e.R7$(4),e.JRh(e.bMT(5,1,t.existingModification.implementedChanges))}}function D(i,n){if(1&i&&(e.j41(0,"section",18)(1,"h2",19),e.EFF(2,"Review Status"),e.k0s(),e.j41(3,"div",54)(4,"div",46)(5,"div")(6,"span",15),e.EFF(7,"Status:"),e.k0s(),e.j41(8,"span",55),e.EFF(9),e.k0s()(),e.DNE(10,R,4,1,"div",56),e.k0s(),e.DNE(11,y,5,1,"div",57),e.DNE(12,C,6,3,"div",58),e.k0s()()),2&i){const t=e.XpG(2);e.R7$(8),e.Y8G("ngClass",t.getStatusBadgeClass(t.existingModification.status)),e.R7$(1),e.SpI(" ",t.existingModification.status," "),e.R7$(1),e.Y8G("ngIf",t.existingModification.reviewedAt),e.R7$(1),e.Y8G("ngIf",t.existingModification.rejectionReason),e.R7$(1),e.Y8G("ngIf",t.existingModification.implementedChanges)}}function N(i,n){1&i&&(e.j41(0,"span"),e.EFF(1,"Submit Modification Request"),e.k0s())}function T(i,n){1&i&&(e.j41(0,"span"),e.EFF(1,"Submitting..."),e.k0s())}function G(i,n){if(1&i){const t=e.RV6();e.j41(0,"div",65)(1,"button",66),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.submitModification())}),e.DNE(2,N,2,0,"span",56),e.DNE(3,T,2,0,"span",56),e.k0s()()}if(2&i){const t=e.XpG(2);e.R7$(1),e.Y8G("disabled",t.submitting||t.form.invalid),e.R7$(1),e.Y8G("ngIf",!t.submitting),e.R7$(1),e.Y8G("ngIf",t.submitting)}}function $(i,n){if(1&i){const t=e.RV6();e.j41(0,"div",65)(1,"button",67),e.bIt("click",function(){e.eBV(t);const s=e.XpG(2);return e.Njj(s.navigateToDashboard())}),e.EFF(2," Back to Dashboard "),e.k0s()()}}function w(i,n){if(1&i){const t=e.RV6();e.j41(0,"form",17)(1,"section",18)(2,"h2",19),e.EFF(3,"Modification Details"),e.k0s(),e.DNE(4,k,20,4,"div",20),e.j41(5,"div",21)(6,"label",22),e.EFF(7,"Type of Modification "),e.j41(8,"span",23),e.EFF(9,"*"),e.k0s()(),e.j41(10,"div",21),e.DNE(11,M,4,2,"label",24),e.k0s(),e.DNE(12,E,2,0,"p",25),e.k0s(),e.j41(13,"div",21)(14,"label",26),e.EFF(15,"Reason for Modification "),e.j41(16,"span",23),e.EFF(17,"*"),e.k0s()(),e.nrm(18,"textarea",27),e.k0s(),e.j41(19,"div",21)(20,"label",28),e.EFF(21,"Proposed Changes "),e.j41(22,"span",23),e.EFF(23,"*"),e.k0s()(),e.nrm(24,"textarea",29),e.k0s(),e.j41(25,"div",30)(26,"div",21)(27,"label",31),e.EFF(28,"Requested Effective Date "),e.j41(29,"span",23),e.EFF(30,"*"),e.k0s()(),e.nrm(31,"input",32),e.k0s(),e.j41(32,"div",21)(33,"label",33),e.EFF(34,"Fee Adjustment Needed "),e.j41(35,"span",23),e.EFF(36,"*"),e.k0s()(),e.j41(37,"select",34)(38,"option",35),e.EFF(39,"Select option"),e.k0s(),e.DNE(40,j,2,2,"option",36),e.k0s()()(),e.j41(41,"div",21)(42,"label",37),e.EFF(43,"Impact Assessment"),e.k0s(),e.nrm(44,"textarea",38),e.k0s(),e.j41(45,"div",21)(46,"label",22),e.EFF(47,"Supporting Justification Document"),e.k0s(),e.j41(48,"input",39),e.bIt("change",function(s){e.eBV(t);const d=e.XpG();return e.Njj(d.onJustificationFileSelected(s))}),e.k0s(),e.j41(49,"p",40),e.EFF(50,"Upload business case document or justification (PDF, DOC, DOCX)"),e.k0s(),e.DNE(51,I,5,1,"div",41),e.k0s()(),e.DNE(52,D,13,5,"section",42),e.DNE(53,G,4,3,"div",43),e.DNE(54,$,3,0,"div",43),e.k0s()}if(2&i){const t=e.XpG();let o;e.Y8G("formGroup",t.form),e.R7$(4),e.Y8G("ngIf",t.agreement),e.R7$(7),e.Y8G("ngForOf",t.modificationTypeOptions),e.R7$(1),e.Y8G("ngIf",(null==(o=t.form.get("modificationTypes"))?null:o.invalid)&&(null==(o=t.form.get("modificationTypes"))?null:o.touched)),e.R7$(28),e.Y8G("ngForOf",t.feeAdjustmentOptions),e.R7$(11),e.Y8G("ngIf",t.justificationFile),e.R7$(1),e.Y8G("ngIf",t.existingModification&&"PENDING"!==t.existingModification.status),e.R7$(1),e.Y8G("ngIf",!t.existingModification||"PENDING"===t.existingModification.status),e.R7$(1),e.Y8G("ngIf",t.existingModification&&"PENDING"!==t.existingModification.status)}}function A(i,n){1&i&&(e.j41(0,"div",68)(1,"p",69),e.EFF(2,"Loading..."),e.k0s()())}let p=(()=>{class i{constructor(t,o,s,d,O){this.fb=t,this.modificationService=o,this.agreementService=s,this.route=d,this.router=O,this.loading=!1,this.submitting=!1,this.error="",this.success=!1,this.successMessage="",this.licenseId=null,this.agreement=null,this.existingModification=null,this.modificationId=null,this.modificationTypeOptions=[{value:"EXTEND_DURATION",label:"Extend Duration"},{value:"CHANGE_SCOPE",label:"Change Scope"},{value:"ADD_NEW_MARKS",label:"Add New Marks"},{value:"CHANGE_MEDIA",label:"Change Media"},{value:"UPDATE_CONTACT",label:"Update Contact"},{value:"OTHER",label:"Other"}],this.feeAdjustmentOptions=[{value:"YES",label:"Yes"},{value:"NO",label:"No"},{value:"TO_BE_DETERMINED",label:"To Be Determined"}],this.justificationFile=null,this.form=this.createForm()}ngOnInit(){this.route.params.subscribe(t=>{this.licenseId=t.licenseId,this.modificationId=t.id,this.licenseId&&this.loadAgreement(),this.modificationId&&this.loadModification()})}createForm(){return this.fb.group({originalLicenseId:["",[r.k0.required]],modificationTypes:[[],[r.k0.required,this.arrayNotEmptyValidator]],modificationReason:["",[r.k0.required]],proposedChanges:["",[r.k0.required]],effectiveDateRequest:["",[r.k0.required]],supportingJustificationPath:[""],impactAssessment:[""],feeAdjustmentNeeded:["",[r.k0.required]]})}arrayNotEmptyValidator(t){return t.value&&Array.isArray(t.value)&&0!==t.value.length?null:{arrayNotEmpty:!0}}loadAgreement(){this.licenseId&&(this.loading=!0,this.agreementService.getAgreementById(this.licenseId).pipe((0,f.j)(()=>{this.loading=!1})).subscribe({next:t=>{this.agreement=t,this.form.patchValue({originalLicenseId:this.licenseId})},error:t=>{this.error=t.error?.message||"Failed to load license agreement."}}))}loadModification(){this.modificationId&&(this.loading=!0,this.modificationService.getModificationById(this.modificationId).pipe((0,f.j)(()=>{this.loading=!1})).subscribe({next:t=>{this.existingModification=t,this.licenseId=t.originalLicenseId,this.loadAgreement(),this.loadModificationData(t)},error:t=>{this.error=t.error?.message||"Failed to load modification request."}}))}loadModificationData(t){this.form.patchValue({modificationTypes:t.modificationTypes,modificationReason:t.modificationReason,proposedChanges:t.proposedChanges,effectiveDateRequest:t.effectiveDateRequest.split("T")[0],impactAssessment:t.impactAssessment,feeAdjustmentNeeded:t.feeAdjustmentNeeded})}onJustificationFileSelected(t){const o=t.target.files[0];o&&(this.justificationFile=o)}removeJustificationFile(){this.justificationFile=null}submitModification(){if(this.form.invalid)return this.markFormGroupTouched(this.form),void(this.error="Please fill in all required fields correctly.");this.submitting=!0,this.error="";const o={...this.form.getRawValue(),supportingJustificationPath:this.justificationFile?.name||void 0};this.modificationService.requestModification(o).pipe((0,f.j)(()=>{this.submitting=!1})).subscribe({next:d=>{this.existingModification=d,this.success=!0,this.successMessage="Modification request submitted successfully!",setTimeout(()=>{this.router.navigate(["/mark-licenses/dashboard"])},2e3)},error:d=>{this.error=d.error?.message||"Failed to submit modification request. Please try again."}})}markFormGroupTouched(t){Object.keys(t.controls).forEach(o=>{t.get(o)?.markAsTouched()})}getStatusBadgeClass(t){switch(t){case"APPROVED":return"bg-emerald-100 text-emerald-800";case"REJECTED":return"bg-red-100 text-red-800";case"PENDING":return"bg-amber-100 text-amber-800";case"UNDER_REVIEW":return"bg-blue-100 text-blue-800";case"IMPLEMENTED":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}}formatDate(t){return t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):""}navigateToDashboard(){this.router.navigate(["/mark-licenses/dashboard"])}static{this.\u0275fac=function(o){return new(o||i)(e.rXU(r.ok),e.rXU(b),e.rXU(h.G),e.rXU(l.nX),e.rXU(l.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-mark-license-modification"]],decls:13,vars:6,consts:[[1,"w-full","max-w-6xl","mx-auto"],[1,"bg-white","rounded-xl","shadow-sm","border","border-slate-200","overflow-hidden"],[1,"px-8","py-6","border-b","border-slate-100","bg-slate-50/50"],[1,"text-2xl","font-bold","text-slate-900"],[1,"mt-1","text-sm","font-medium","text-slate-600"],["class","mt-1 text-sm text-slate-500",4,"ngIf"],["class","mt-2",4,"ngIf"],["class","mx-8 mt-6 p-4 bg-emerald-50 border border-emerald-200 rounded-lg text-emerald-800",4,"ngIf"],["class","mx-8 mt-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800",4,"ngIf"],["class","p-8 space-y-10",3,"formGroup",4,"ngIf"],["class","p-8 text-center",4,"ngIf"],[1,"mt-1","text-sm","text-slate-500"],[1,"mt-2"],[1,"px-3","py-1","rounded-full","text-sm","font-semibold",3,"ngClass"],[1,"mx-8","mt-6","p-4","bg-emerald-50","border","border-emerald-200","rounded-lg","text-emerald-800"],[1,"font-semibold"],[1,"mx-8","mt-6","p-4","bg-red-50","border","border-red-200","rounded-lg","text-red-800"],[1,"p-8","space-y-10",3,"formGroup"],[1,"space-y-6"],[1,"text-lg","font-bold","text-slate-900","border-b","border-slate-200","pb-3"],["class","p-4 bg-blue-50 rounded-lg border border-blue-200",4,"ngIf"],[1,"space-y-2"],[1,"block","text-sm","font-semibold","text-slate-700"],[1,"text-red-500"],["class","flex items-center space-x-2 cursor-pointer",4,"ngFor","ngForOf"],["class","text-xs text-red-500 mt-1",4,"ngIf"],["for","modificationReason",1,"block","text-sm","font-semibold","text-slate-700"],["id","modificationReason","formControlName","modificationReason","rows","4","placeholder","Explain why this modification is needed",1,"w-full","rounded-lg","border","border-slate-300","bg-white","px-3","py-2.5","text-sm","focus:border-blue-600","focus:ring-1","focus:ring-blue-600","focus:outline-none"],["for","proposedChanges",1,"block","text-sm","font-semibold","text-slate-700"],["id","proposedChanges","formControlName","proposedChanges","rows","6","placeholder","Describe in detail what changes you are requesting",1,"w-full","rounded-lg","border","border-slate-300","bg-white","px-3","py-2.5","text-sm","focus:border-blue-600","focus:ring-1","focus:ring-blue-600","focus:outline-none"],[1,"grid","gap-6","md:grid-cols-2"],["for","effectiveDateRequest",1,"block","text-sm","font-semibold","text-slate-700"],["type","date","id","effectiveDateRequest","formControlName","effectiveDateRequest",1,"w-full","rounded-lg","border","border-slate-300","bg-white","px-3","py-2.5","text-sm","focus:border-blue-600","focus:ring-1","focus:ring-blue-600","focus:outline-none"],["for","feeAdjustmentNeeded",1,"block","text-sm","font-semibold","text-slate-700"],["id","feeAdjustmentNeeded","formControlName","feeAdjustmentNeeded",1,"w-full","rounded-lg","border","border-slate-300","bg-white","px-3","py-2.5","text-sm","focus:border-blue-600","focus:ring-1","focus:ring-blue-600","focus:outline-none"],["value","","disabled",""],[3,"value",4,"ngFor","ngForOf"],["for","impactAssessment",1,"block","text-sm","font-semibold","text-slate-700"],["id","impactAssessment","formControlName","impactAssessment","rows","4","placeholder","How will these changes affect your usage of the marks?",1,"w-full","rounded-lg","border","border-slate-300","bg-white","px-3","py-2.5","text-sm","focus:border-blue-600","focus:ring-1","focus:ring-blue-600","focus:outline-none"],["type","file","accept",".pdf,.doc,.docx",1,"w-full","rounded-lg","border","border-slate-300","bg-white","px-3","py-2.5","text-sm",3,"change"],[1,"text-xs","text-slate-500","mt-1"],["class","mt-2 flex items-center justify-between p-2 bg-slate-50 rounded",4,"ngIf"],["class","space-y-6",4,"ngIf"],["class","flex gap-4 justify-end pt-6 border-t border-slate-200",4,"ngIf"],[1,"p-4","bg-blue-50","rounded-lg","border","border-blue-200"],[1,"font-semibold","text-slate-900","mb-2"],[1,"grid","gap-4","md:grid-cols-2","text-sm"],[1,"flex","items-center","space-x-2","cursor-pointer"],["type","checkbox","formControlName","modificationTypes",1,"rounded","border-slate-300","text-blue-600","focus:ring-blue-600",3,"value"],[1,"text-sm","text-slate-700"],[1,"text-xs","text-red-500","mt-1"],[3,"value"],[1,"mt-2","flex","items-center","justify-between","p-2","bg-slate-50","rounded"],["type","button",1,"text-red-600","hover:text-red-800","text-sm",3,"click"],[1,"p-4","bg-slate-50","rounded-lg","border","border-slate-200","space-y-3"],[1,"ml-2","px-2","py-1","rounded","text-xs","font-semibold",3,"ngClass"],[4,"ngIf"],["class","p-3 bg-red-50 rounded border border-red-200",4,"ngIf"],["class","p-3 bg-green-50 rounded border border-green-200",4,"ngIf"],[1,"p-3","bg-red-50","rounded","border","border-red-200"],[1,"font-semibold","text-red-800","text-sm","mb-1"],[1,"text-sm","text-red-700"],[1,"p-3","bg-green-50","rounded","border","border-green-200"],[1,"font-semibold","text-green-800","text-sm","mb-1"],[1,"text-sm","text-green-700","whitespace-pre-wrap"],[1,"flex","gap-4","justify-end","pt-6","border-t","border-slate-200"],["type","button",1,"px-6","py-2.5","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors",3,"disabled","click"],["type","button",1,"px-6","py-2.5","bg-blue-600","text-white","rounded-lg","hover:bg-blue-700","transition-colors",3,"click"],[1,"p-8","text-center"],[1,"text-slate-600"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"h1",3),e.EFF(4,"License Modification Request"),e.k0s(),e.j41(5,"p",4),e.EFF(6,"Form NSB-004-4: Request to Modify Existing ARSO Mark License"),e.k0s(),e.DNE(7,x,2,1,"p",5),e.DNE(8,_,3,2,"div",6),e.k0s(),e.DNE(9,v,3,1,"div",7),e.DNE(10,F,2,1,"div",8),e.DNE(11,w,55,9,"form",9),e.DNE(12,A,3,0,"div",10),e.k0s()()),2&o&&(e.R7$(7),e.Y8G("ngIf",s.agreement),e.R7$(1),e.Y8G("ngIf",s.existingModification),e.R7$(1),e.Y8G("ngIf",s.success),e.R7$(1),e.Y8G("ngIf",s.error),e.R7$(1),e.Y8G("ngIf",!s.loading),e.R7$(1),e.Y8G("ngIf",s.loading))},dependencies:[c.YU,c.Sq,c.bT,r.qT,r.xH,r.y7,r.me,r.Zm,r.wz,r.BC,r.cb,r.j4,r.JD,c.TG],styles:["[_nghost-%COMP%]{display:block;width:100%}.status-badge[_ngcontent-%COMP%]{transition:all .2s ease}.modification-details[_ngcontent-%COMP%]{background:linear-gradient(to bottom,#f8fafc,#ffffff)}.file-upload-area[_ngcontent-%COMP%]{border:2px dashed #cbd5e1;border-radius:.5rem;padding:1.5rem;text-align:center;transition:all .2s ease}.file-upload-area[_ngcontent-%COMP%]:hover{border-color:#3b82f6;background-color:#eff6ff}.review-status[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_slideDown .3s ease}@keyframes _ngcontent-%COMP%_slideDown{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}"]})}}return i})();const L=[{path:"new/:licenseId",component:p},{path:":id",component:p}];let S=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[c.MD,r.X1,l.iI.forChild(L)]})}}return i})()}}]);