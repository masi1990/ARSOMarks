"use strict";(self.webpackChunkarsomarks_frontend=self.webpackChunkarsomarks_frontend||[]).push([[638],{3638:(C,u,l)=>{l.r(u),l.d(u,{ApprovalsModule:()=>T});var c=l(177),n=l(9417),f=l(1377),b=l(7468),d=l(980),m=l(1749),e=l(6276),v=l(3769),h=l(3571);function x(i,p){1&i&&(e.j41(0,"div",26)(1,"p",27),e.EFF(2,"Loading requests..."),e.k0s()())}function g(i,p){1&i&&(e.j41(0,"div",28)(1,"p",27),e.EFF(2,"No requests found matching your filters."),e.k0s()())}function R(i,p){if(1&i&&(e.j41(0,"p",49)(1,"span",47),e.EFF(2,"Note:"),e.k0s(),e.EFF(3),e.k0s()),2&i){const t=e.XpG(2).$implicit;e.R7$(3),e.SpI(' "',t.notes,'"')}}function E(i,p){if(1&i&&(e.j41(0,"div",45)(1,"p",46)(2,"span",47),e.EFF(3,"Action by:"),e.k0s(),e.EFF(4),e.k0s(),e.DNE(5,R,4,1,"p",48),e.k0s()),2&i){const t=e.XpG().$implicit;e.R7$(4),e.SpI(" ",t.reviewedBy||"System",""),e.R7$(1),e.Y8G("ngIf",t.notes)}}function F(i,p){if(1&i){const t=e.RV6();e.j41(0,"div",50)(1,"button",51),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,r=e.XpG();return e.Njj(r.openDecisionModal(s,"approve"))}),e.EFF(2," Approve "),e.k0s(),e.j41(3,"button",52),e.bIt("click",function(){e.eBV(t);const s=e.XpG().$implicit,r=e.XpG();return e.Njj(r.openDecisionModal(s,"reject"))}),e.EFF(4," Reject "),e.k0s()()}}function _(i,p){if(1&i&&(e.j41(0,"div",29)(1,"div",30)(2,"div",31)(3,"div",32)(4,"span",33),e.EFF(5),e.k0s()(),e.j41(6,"div")(7,"div",34)(8,"span",35),e.EFF(9),e.k0s(),e.j41(10,"span",36),e.EFF(11),e.nI1(12,"date"),e.k0s()(),e.j41(13,"h3",37),e.EFF(14),e.j41(15,"span",38),e.EFF(16,"from"),e.k0s(),e.EFF(17),e.k0s(),e.j41(18,"p",39),e.EFF(19),e.k0s(),e.j41(20,"p",40),e.EFF(21),e.k0s(),e.DNE(22,E,6,2,"div",41),e.k0s()(),e.j41(23,"div",42)(24,"span",43),e.EFF(25),e.k0s(),e.DNE(26,F,5,0,"div",44),e.k0s()()()),2&i){const t=p.$implicit,o=e.XpG();e.R7$(3),e.Y8G("ngClass","ROLE_REQUEST"===t.type?"bg-purple-100 text-purple-600":"bg-orange-100 text-orange-600"),e.R7$(2),e.JRh("ROLE_REQUEST"===t.type?"\u{1f464}":"\u{1f3e2}"),e.R7$(4),e.JRh(o.getTypeLabel(t.type)),e.R7$(2),e.SpI("\u2022 ",e.i5U(12,13,t.submittedAt,"mediumDate"),""),e.R7$(3),e.SpI("",t.title," "),e.R7$(3),e.SpI(" ",t.requesterName,""),e.R7$(2),e.JRh(t.subtitle),e.R7$(2),e.JRh(t.requesterEmail),e.R7$(1),e.Y8G("ngIf","history"===o.activeTab),e.R7$(2),e.HbH(o.getStatusClass(t.status)),e.R7$(1),e.SpI(" ",t.status," "),e.R7$(1),e.Y8G("ngIf","pending"===o.activeTab)}}function k(i,p){if(1&i&&(e.j41(0,"div",68),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(1),e.SpI(" ",t.modalError," ")}}function y(i,p){if(1&i&&(e.j41(0,"div",69),e.EFF(1),e.k0s()),2&i){const t=e.XpG(2);e.R7$(1),e.SpI(" ",t.modalSuccess," ")}}function I(i,p){if(1&i){const t=e.RV6();e.j41(0,"div",53)(1,"div",54)(2,"div",55)(3,"h3",37),e.EFF(4),e.k0s(),e.j41(5,"button",56),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.closeModal())}),e.EFF(6,"\u2715"),e.k0s()(),e.j41(7,"div",57)(8,"div",58)(9,"p",59),e.EFF(10),e.k0s(),e.j41(11,"p",60),e.EFF(12),e.k0s()(),e.j41(13,"div")(14,"label",61),e.EFF(15," Comments / Reason "),e.j41(16,"span",38),e.EFF(17,"(Optional)"),e.k0s()(),e.j41(18,"textarea",62),e.bIt("ngModelChange",function(s){e.eBV(t);const r=e.XpG();return e.Njj(r.decisionNote=s)}),e.k0s()(),e.DNE(19,k,2,1,"div",63),e.DNE(20,y,2,1,"div",64),e.k0s(),e.j41(21,"div",65)(22,"button",66),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.closeModal())}),e.EFF(23," Cancel "),e.k0s(),e.j41(24,"button",67),e.bIt("click",function(){e.eBV(t);const s=e.XpG();return e.Njj(s.submitDecision())}),e.EFF(25),e.k0s()()()()}if(2&i){const t=e.XpG();e.R7$(4),e.SpI(" ","approve"===t.actionType?"Approve Request":"Reject Request"," "),e.R7$(6),e.JRh(t.selectedItem.title),e.R7$(2),e.JRh(t.selectedItem.subtitle),e.R7$(6),e.Y8G("ngModel",t.decisionNote),e.R7$(1),e.Y8G("ngIf",t.modalError),e.R7$(1),e.Y8G("ngIf",t.modalSuccess),e.R7$(4),e.HbH("approve"===t.actionType?"bg-emerald-600 hover:bg-emerald-700":"bg-rose-600 hover:bg-rose-700"),e.Y8G("disabled",t.processing),e.R7$(1),e.SpI(" ",t.processing?"Processing...":"Confirm"," ")}}const j=[{path:"",component:(()=>{class i{constructor(t,o,s){this.authService=t,this.nsbService=o,this.fb=s,this.activeTab="pending",this.items=[],this.filteredItems=[],this.loading=!1,this.error="",this.selectedItem=null,this.actionType=null,this.decisionNote="",this.processing=!1,this.modalError="",this.modalSuccess="",this.filterForm=this.fb.group({search:[""],type:[""]})}ngOnInit(){this.loadData(),this.setupFilters()}loadData(){this.loading=!0,this.error="",(0,b.p)({roleRequests:this.authService.listRoleRequests(),nsbRequests:this.nsbService.list({limit:100})}).pipe((0,d.j)(()=>{this.loading=!1})).subscribe({next:t=>{const o=(t.roleRequests||[]).map(r=>this.mapRoleRequest(r)),s=(t.nsbRequests.data||[]).map(r=>this.mapNsbRequest(r));this.items=[...o,...s].sort((r,a)=>new Date(a.submittedAt).getTime()-new Date(r.submittedAt).getTime()),this.applyFilters()},error:t=>{this.error="Failed to load approval requests.",console.error(t)}})}mapRoleRequest(t){return{id:t.id,type:"ROLE_REQUEST",title:"User Role Request",subtitle:t.requestedRoles.join(", ").replace(/_/g," "),requesterName:t.user?.fullName||"Unknown User",requesterEmail:t.user?.email||t.userId,status:t.status,submittedAt:t.createdAt,reviewedBy:t.reviewedBy||void 0,reviewedAt:t.reviewedAt||void 0,notes:t.decisionNote||void 0,originalRequest:t}}mapNsbRequest(t){return{id:t.id||"",type:"NSB_REGISTRATION",title:"NSB Registration",subtitle:`${t.nsbOfficialName} (${t.countryName})`,requesterName:t.contactPersonName,requesterEmail:t.contactEmail,status:t.status,submittedAt:t.createdAt||"",reviewedBy:t.reviewedBy,reviewedAt:t.reviewedAt,notes:t.remarks,originalRequest:t}}setupFilters(){this.filterForm.valueChanges.subscribe(()=>{this.applyFilters()})}applyFilters(){const{search:t,type:o}=this.filterForm.value,s=(t||"").toLowerCase();let r=this.items.filter(a=>"pending"===this.activeTab?["PENDING","SUBMITTED","UNDER_REVIEW","DRAFT"].includes(a.status):["APPROVED","REJECTED"].includes(a.status));s&&(r=r.filter(a=>a.title.toLowerCase().includes(s)||a.subtitle.toLowerCase().includes(s)||a.requesterName.toLowerCase().includes(s)||a.requesterEmail.toLowerCase().includes(s))),o&&(r=r.filter(a=>a.type===o)),this.filteredItems=r}setActiveTab(t){this.activeTab=t,this.applyFilters()}openDecisionModal(t,o){this.selectedItem=t,this.actionType=o,this.decisionNote="",this.modalError="",this.modalSuccess=""}closeModal(){this.selectedItem=null,this.actionType=null,this.decisionNote=""}submitDecision(){this.selectedItem&&this.actionType&&(this.processing=!0,this.modalError="","ROLE_REQUEST"===this.selectedItem.type?this.authService.decideRoleRequest(this.selectedItem.id,{status:"approve"===this.actionType?m.c.APPROVED:m.c.REJECTED,note:this.decisionNote}).pipe((0,d.j)(()=>this.processing=!1)).subscribe({next:()=>this.handleSuccess(),error:o=>this.modalError=o.error?.message||"Failed to process request."}):"NSB_REGISTRATION"===this.selectedItem.type&&("approve"===this.actionType?this.nsbService.approve(this.selectedItem.id,this.decisionNote):this.nsbService.reject(this.selectedItem.id,this.decisionNote)).pipe((0,d.j)(()=>this.processing=!1)).subscribe({next:()=>this.handleSuccess(),error:o=>this.modalError=o.error?.message||"Failed to process request."}))}handleSuccess(){this.modalSuccess="Request processed successfully.",setTimeout(()=>{this.closeModal(),this.loadData()},1500)}getStatusClass(t){switch(t){case"APPROVED":return"bg-emerald-100 text-emerald-800";case"REJECTED":return"bg-rose-100 text-rose-800";case"PENDING":case"SUBMITTED":case"UNDER_REVIEW":return"bg-blue-100 text-blue-800";default:return"bg-slate-100 text-slate-800"}}getTypeLabel(t){return"ROLE_REQUEST"===t?"Role Request":"NSB Registration"}static{this.\u0275fac=function(o){return new(o||i)(e.rXU(v.u),e.rXU(h.p),e.rXU(n.ok))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-approvals"]],decls:39,vars:9,consts:[[1,"space-y-6"],[1,"card-surface","px-6","py-6"],[1,"flex","flex-col","gap-3"],[1,"text-xs","font-semibold","uppercase","tracking-[0.14em]","text-slate-500"],[1,"flex","items-center","justify-between"],[1,"text-2xl","font-semibold","text-slate-900"],[1,"text-sm","text-blue-600","hover:text-blue-800","font-medium","flex","items-center","gap-1",3,"click"],[1,"max-w-3xl","text-sm","text-slate-600"],[1,"mt-8","border-b","border-slate-200"],[1,"flex","gap-8"],[1,"pb-3","text-sm","font-semibold","transition","border-b-2",3,"ngClass","click"],[1,"card-surface","px-6","py-4"],[1,"flex","flex-wrap","gap-4","items-center",3,"formGroup"],[1,"relative","flex-1","min-w-[240px]"],[1,"absolute","left-3","top-1/2","-translate-y-1/2","text-slate-400"],["type","text","formControlName","search","placeholder","Search by name, email, or request details...",1,"w-full","pl-9","pr-4","py-2","rounded-lg","border","border-slate-300","text-sm","focus:border-slate-900","focus:outline-none"],[1,"w-48"],["formControlName","type",1,"w-full","px-3","py-2","rounded-lg","border","border-slate-300","text-sm","focus:border-slate-900","focus:outline-none","bg-white"],["value",""],["value","ROLE_REQUEST"],["value","NSB_REGISTRATION"],[1,"space-y-4"],["class","text-center py-12",4,"ngIf"],["class","card-surface p-8 text-center",4,"ngIf"],["class","card-surface p-5 hover:border-blue-300 transition-colors border border-transparent",4,"ngFor","ngForOf"],["class","fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4",4,"ngIf"],[1,"text-center","py-12"],[1,"text-slate-500"],[1,"card-surface","p-8","text-center"],[1,"card-surface","p-5","hover:border-blue-300","transition-colors","border","border-transparent"],[1,"flex","flex-wrap","items-start","justify-between","gap-4"],[1,"flex","gap-4"],[1,"h-10","w-10","rounded-full","flex","items-center","justify-center","shrink-0",3,"ngClass"],[1,"text-lg"],[1,"flex","items-center","gap-2","mb-1"],[1,"text-xs","font-bold","uppercase","tracking-wider","text-slate-500"],[1,"text-xs","text-slate-400"],[1,"font-semibold","text-slate-900"],[1,"text-slate-400","font-normal"],[1,"text-sm","text-slate-600","mt-1"],[1,"text-xs","text-slate-500","mt-1"],["class","mt-3 pt-3 border-t border-slate-100 text-sm",4,"ngIf"],[1,"flex","flex-col","items-end","gap-3"],[1,"px-2.5","py-0.5","rounded-full","text-xs","font-medium"],["class","flex gap-2",4,"ngIf"],[1,"mt-3","pt-3","border-t","border-slate-100","text-sm"],[1,"text-slate-700"],[1,"font-medium"],["class","text-slate-700 mt-1",4,"ngIf"],[1,"text-slate-700","mt-1"],[1,"flex","gap-2"],[1,"px-3","py-1.5","bg-emerald-600","hover:bg-emerald-700","text-white","text-xs","font-semibold","rounded-lg","transition","shadow-sm",3,"click"],[1,"px-3","py-1.5","bg-white","border","border-rose-200","text-rose-700","hover:bg-rose-50","text-xs","font-semibold","rounded-lg","transition",3,"click"],[1,"fixed","inset-0","z-50","flex","items-center","justify-center","bg-black/50","backdrop-blur-sm","p-4"],[1,"bg-white","rounded-xl","shadow-xl","max-w-md","w-full","overflow-hidden"],[1,"px-6","py-4","border-b","border-slate-100","flex","justify-between","items-center"],[1,"text-slate-400","hover:text-slate-600",3,"click"],[1,"p-6","space-y-4"],[1,"bg-slate-50","p-3","rounded-lg","text-sm"],[1,"font-medium","text-slate-900"],[1,"text-slate-600"],[1,"block","text-sm","font-medium","text-slate-700","mb-1"],["rows","3","placeholder","Add a note to the requester...",1,"w-full","rounded-lg","border","border-slate-300","p-2","text-sm","focus:border-slate-900","focus:outline-none",3,"ngModel","ngModelChange"],["class","text-sm text-rose-600 bg-rose-50 p-2 rounded",4,"ngIf"],["class","text-sm text-emerald-600 bg-emerald-50 p-2 rounded",4,"ngIf"],[1,"px-6","py-4","bg-slate-50","border-t","border-slate-100","flex","justify-end","gap-3"],[1,"px-4","py-2","text-sm","font-medium","text-slate-600","hover:text-slate-800",3,"click"],[1,"px-4","py-2","text-sm","font-medium","text-white","rounded-lg","transition","disabled:opacity-50",3,"disabled","click"],[1,"text-sm","text-rose-600","bg-rose-50","p-2","rounded"],[1,"text-sm","text-emerald-600","bg-emerald-50","p-2","rounded"]],template:function(o,s){1&o&&(e.j41(0,"div",0)(1,"section",1)(2,"div",2)(3,"p",3),e.EFF(4,"Approver Console"),e.k0s(),e.j41(5,"div",4)(6,"h1",5),e.EFF(7,"Approvals & Requests"),e.k0s(),e.j41(8,"button",6),e.bIt("click",function(){return s.loadData()}),e.j41(9,"span"),e.EFF(10,"\u21bb"),e.k0s(),e.EFF(11," Refresh "),e.k0s()(),e.j41(12,"p",7),e.EFF(13," Consolidated view of all pending role assignments and NSB registration requests requiring your attention. "),e.k0s()(),e.j41(14,"div",8)(15,"div",9)(16,"button",10),e.bIt("click",function(){return s.setActiveTab("pending")}),e.EFF(17," Pending Review "),e.k0s(),e.j41(18,"button",10),e.bIt("click",function(){return s.setActiveTab("history")}),e.EFF(19," History & Logs "),e.k0s()()()(),e.j41(20,"section",11)(21,"form",12)(22,"div",13)(23,"span",14),e.EFF(24,"\u{1f50d}"),e.k0s(),e.nrm(25,"input",15),e.k0s(),e.j41(26,"div",16)(27,"select",17)(28,"option",18),e.EFF(29,"All Request Types"),e.k0s(),e.j41(30,"option",19),e.EFF(31,"Role Requests"),e.k0s(),e.j41(32,"option",20),e.EFF(33,"NSB Registrations"),e.k0s()()()()(),e.j41(34,"section",21),e.DNE(35,x,3,0,"div",22),e.DNE(36,g,3,0,"div",23),e.DNE(37,_,27,16,"div",24),e.k0s(),e.DNE(38,I,26,10,"div",25),e.k0s()),2&o&&(e.R7$(9),e.AVh("animate-spin",s.loading),e.R7$(7),e.Y8G("ngClass","pending"===s.activeTab?"border-slate-900 text-slate-900":"border-transparent text-slate-500 hover:text-slate-700"),e.R7$(2),e.Y8G("ngClass","history"===s.activeTab?"border-slate-900 text-slate-900":"border-transparent text-slate-500 hover:text-slate-700"),e.R7$(3),e.Y8G("formGroup",s.filterForm),e.R7$(14),e.Y8G("ngIf",s.loading),e.R7$(1),e.Y8G("ngIf",!s.loading&&0===s.filteredItems.length),e.R7$(1),e.Y8G("ngForOf",s.filteredItems),e.R7$(1),e.Y8G("ngIf",s.selectedItem))},dependencies:[c.YU,c.Sq,c.bT,n.qT,n.xH,n.y7,n.me,n.wz,n.BC,n.cb,n.vS,n.j4,n.JD,c.vh],styles:["[_nghost-%COMP%]{display:block}"]})}}return i})()}];let T=(()=>{class i{static{this.\u0275fac=function(o){return new(o||i)}}static{this.\u0275mod=e.$C({type:i})}static{this.\u0275inj=e.G2t({imports:[c.MD,n.YN,n.X1,f.iI.forChild(j)]})}}return i})()}}]);