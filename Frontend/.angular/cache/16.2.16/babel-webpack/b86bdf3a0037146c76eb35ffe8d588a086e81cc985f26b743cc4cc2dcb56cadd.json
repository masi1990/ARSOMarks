{"ast":null,"code":"import { UserRole } from '../../shared/models/user.model';\nexport class StakeholderRegistryListComponent {\n  constructor(nsbService, stakeholderService, authService, router) {\n    this.nsbService = nsbService;\n    this.stakeholderService = stakeholderService;\n    this.authService = authService;\n    this.router = router;\n    this.stakeholders = [];\n    this.filteredStakeholders = [];\n    this.nsbs = [];\n    this.loading = false;\n    this.error = '';\n    this.searchQuery = '';\n    this.filterType = 'ALL';\n    this.currentPage = 1;\n    this.itemsPerPage = 10;\n    this.totalPages = 1;\n  }\n  ngOnInit() {\n    this.loadStakeholders();\n  }\n  loadStakeholders() {\n    this.loading = true;\n    this.error = '';\n    const user = this.authService.currentUserValue;\n    const userRoles = user?.roles || (user?.role ? [user.role] : []);\n    const isSuperAdmin = userRoles.includes(UserRole.SUPER_ADMIN) || userRoles.includes(UserRole.ARSO_SECRETARIAT);\n    // First load NSBs\n    if (isSuperAdmin) {\n      this.nsbService.getNsbList({\n        limit: 1000\n      }).subscribe({\n        next: response => {\n          this.nsbs = response.data || [];\n          this.loadStakeholdersForNsbs();\n        },\n        error: () => {\n          this.error = 'Failed to load NSBs.';\n          this.loading = false;\n        }\n      });\n    } else if (userRoles.includes(UserRole.NSB_ADMIN) || userRoles.includes(UserRole.NSB_USER)) {\n      this.nsbService.getMyNsb().subscribe({\n        next: nsb => {\n          this.nsbs = nsb ? [nsb] : [];\n          this.loadStakeholdersForNsbs();\n        },\n        error: () => {\n          this.error = 'Failed to load your NSB.';\n          this.loading = false;\n        }\n      });\n    } else {\n      this.error = 'You do not have permission to view stakeholder registries.';\n      this.loading = false;\n    }\n  }\n  loadStakeholdersForNsbs() {\n    this.stakeholders = [];\n    const loadPromises = this.nsbs.map(nsb => {\n      if (!nsb.id) return Promise.resolve();\n      return this.stakeholderService.getStakeholderRegistry(nsb.id).toPromise().then(registry => {\n        if (registry) {\n          // Flatten all stakeholders into a single array\n          if (registry.marketSurveillanceAuthorities) {\n            registry.marketSurveillanceAuthorities.forEach(msa => {\n              this.stakeholders.push({\n                id: msa.id || '',\n                type: 'MSA',\n                name: msa.agencyName,\n                category: 'Market Surveillance',\n                contactEmail: msa.contactEmail,\n                contactName: msa.contactPersonName,\n                status: msa.isActive ? 'ACTIVE' : 'INACTIVE',\n                nsbName: nsb.name,\n                nsbId: nsb.id\n              });\n            });\n          }\n          if (registry.customsBorderAgencies) {\n            registry.customsBorderAgencies.forEach(customs => {\n              this.stakeholders.push({\n                id: customs.id || '',\n                type: 'CUSTOMS',\n                name: customs.agencyName,\n                category: 'Customs & Border',\n                contactEmail: customs.coordinatorEmail,\n                contactName: customs.primaryContactName,\n                status: customs.isActive ? 'ACTIVE' : 'INACTIVE',\n                nsbName: nsb.name,\n                nsbId: nsb.id\n              });\n            });\n          }\n          if (registry.regulatoryAgencies) {\n            registry.regulatoryAgencies.forEach(reg => {\n              this.stakeholders.push({\n                id: reg.id || '',\n                type: 'REGULATORY',\n                name: reg.agencyName,\n                category: 'Regulatory Agency',\n                contactEmail: reg.contactEmail || '',\n                contactName: reg.contactPersonName || '',\n                status: reg.isActive ? 'ACTIVE' : 'INACTIVE',\n                nsbName: nsb.name,\n                nsbId: nsb.id\n              });\n            });\n          }\n          if (registry.industryAssociations) {\n            registry.industryAssociations.forEach(industry => {\n              this.stakeholders.push({\n                id: industry.id || '',\n                type: 'INDUSTRY',\n                name: industry.associationName,\n                category: 'Industry Association',\n                contactEmail: industry.contactEmail,\n                contactName: industry.contactPersonName,\n                status: industry.isActive ? 'ACTIVE' : 'INACTIVE',\n                nsbName: nsb.name,\n                nsbId: nsb.id\n              });\n            });\n          }\n          if (registry.testingLaboratories) {\n            registry.testingLaboratories.forEach(lab => {\n              this.stakeholders.push({\n                id: lab.id || '',\n                type: 'LABORATORY',\n                name: lab.name,\n                category: 'Testing Laboratory',\n                contactEmail: lab.contactEmail,\n                contactName: lab.acapContactName,\n                status: lab.isActive ? 'ACTIVE' : 'INACTIVE',\n                nsbName: nsb.name,\n                nsbId: nsb.id\n              });\n            });\n          }\n          if (registry.otherStakeholderGroups) {\n            registry.otherStakeholderGroups.forEach(other => {\n              this.stakeholders.push({\n                id: other.id || '',\n                type: 'OTHER',\n                name: other.primaryContactName,\n                category: other.stakeholderCategory,\n                contactEmail: other.contactEmail,\n                contactName: other.primaryContactName,\n                status: other.isActive ? 'ACTIVE' : 'INACTIVE',\n                nsbName: nsb.name,\n                nsbId: nsb.id\n              });\n            });\n          }\n        }\n      }).catch(() => {\n        // Silently fail for NSBs without stakeholder registries\n      });\n    });\n    Promise.all(loadPromises).then(() => {\n      this.applyFilters();\n      this.loading = false;\n    });\n  }\n  applyFilters() {\n    let filtered = [...this.stakeholders];\n    // Apply type filter\n    if (this.filterType !== 'ALL') {\n      filtered = filtered.filter(stakeholder => stakeholder.type === this.filterType);\n    }\n    // Apply search filter\n    if (this.searchQuery.trim()) {\n      const query = this.searchQuery.toLowerCase();\n      filtered = filtered.filter(stakeholder => stakeholder.name?.toLowerCase().includes(query) || stakeholder.category?.toLowerCase().includes(query) || stakeholder.contactEmail?.toLowerCase().includes(query) || stakeholder.nsbName?.toLowerCase().includes(query));\n    }\n    // Calculate total pages before pagination\n    this.totalPages = Math.ceil(filtered.length / this.itemsPerPage);\n    // Apply pagination\n    const startIndex = (this.currentPage - 1) * this.itemsPerPage;\n    const endIndex = startIndex + this.itemsPerPage;\n    this.filteredStakeholders = filtered.slice(startIndex, endIndex);\n  }\n  onSearchChange() {\n    this.currentPage = 1;\n    this.applyFilters();\n  }\n  onFilterTypeChange() {\n    this.currentPage = 1;\n    this.applyFilters();\n  }\n  getPageNumbers() {\n    const pages = [];\n    const maxPages = Math.min(5, this.totalPages);\n    let startPage = Math.max(1, this.currentPage - Math.floor(maxPages / 2));\n    let endPage = Math.min(this.totalPages, startPage + maxPages - 1);\n    if (endPage - startPage < maxPages - 1) {\n      startPage = Math.max(1, endPage - maxPages + 1);\n    }\n    for (let i = startPage; i <= endPage; i++) {\n      pages.push(i);\n    }\n    return pages;\n  }\n  goToPage(page) {\n    this.currentPage = page;\n    this.applyFilters();\n  }\n  previousPage() {\n    if (this.currentPage > 1) {\n      this.currentPage--;\n      this.applyFilters();\n    }\n  }\n  nextPage() {\n    if (this.currentPage < this.totalPages) {\n      this.currentPage++;\n      this.applyFilters();\n    }\n  }\n  getDisplayRange() {\n    const totalFiltered = this.getTotalFilteredCount();\n    const start = totalFiltered > 0 ? (this.currentPage - 1) * this.itemsPerPage + 1 : 0;\n    const end = Math.min(this.currentPage * this.itemsPerPage, totalFiltered);\n    return totalFiltered > 0 ? `${start} to ${end}` : '0';\n  }\n  getTotalFilteredCount() {\n    let filtered = [...this.stakeholders];\n    if (this.filterType !== 'ALL') {\n      filtered = filtered.filter(stakeholder => stakeholder.type === this.filterType);\n    }\n    if (this.searchQuery.trim()) {\n      const query = this.searchQuery.toLowerCase();\n      filtered = filtered.filter(stakeholder => stakeholder.name?.toLowerCase().includes(query) || stakeholder.category?.toLowerCase().includes(query) || stakeholder.contactEmail?.toLowerCase().includes(query) || stakeholder.nsbName?.toLowerCase().includes(query));\n    }\n    return filtered.length;\n  }\n  getTypeLabel(type) {\n    const labels = {\n      'MSA': 'Market Surveillance',\n      'CUSTOMS': 'Customs & Border',\n      'REGULATORY': 'Regulatory Agency',\n      'INDUSTRY': 'Industry Association',\n      'LABORATORY': 'Testing Laboratory',\n      'OTHER': 'Other Stakeholder'\n    };\n    return labels[type] || type;\n  }\n  getTypeBadgeClass(type) {\n    const classes = {\n      'MSA': 'bg-blue-50 text-blue-700 border-blue-200',\n      'CUSTOMS': 'bg-purple-50 text-purple-700 border-purple-200',\n      'REGULATORY': 'bg-orange-50 text-orange-700 border-orange-200',\n      'INDUSTRY': 'bg-green-50 text-green-700 border-green-200',\n      'LABORATORY': 'bg-indigo-50 text-indigo-700 border-indigo-200',\n      'OTHER': 'bg-gray-50 text-gray-700 border-gray-200'\n    };\n    return classes[type] || 'bg-gray-50 text-gray-700 border-gray-200';\n  }\n  getStatusBadgeClass(status) {\n    return status === 'ACTIVE' ? 'bg-green-50 text-green-700 border-green-200' : 'bg-gray-50 text-gray-700 border-gray-200';\n  }\n  editStakeholder(stakeholder) {\n    // Navigate to stakeholder registry form with the stakeholder ID\n    this.router.navigate(['/portal/nsb/stakeholder-registry'], {\n      queryParams: {\n        nsbId: stakeholder.nsbId,\n        stakeholderId: stakeholder.id,\n        type: stakeholder.type\n      }\n    });\n  }\n  deleteStakeholder(stakeholder) {\n    if (!confirm(`Are you sure you want to delete ${stakeholder.name}?`)) {\n      return;\n    }\n    // TODO: Implement delete functionality via API\n    console.log('Delete stakeholder:', stakeholder);\n    // Reload stakeholders after deletion\n    this.loadStakeholders();\n  }\n  viewStakeholder(stakeholder) {\n    // Navigate to stakeholder details or registry form\n    this.router.navigate(['/portal/nsb/stakeholder-registry'], {\n      queryParams: {\n        nsbId: stakeholder.nsbId,\n        stakeholderId: stakeholder.id,\n        type: stakeholder.type,\n        view: 'true'\n      }\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}