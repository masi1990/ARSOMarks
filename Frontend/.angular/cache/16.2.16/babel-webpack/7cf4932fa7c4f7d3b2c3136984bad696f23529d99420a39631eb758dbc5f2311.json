{"ast":null,"code":"import { FormGroup, Validators } from '@angular/forms';\nimport { ApplicationRegistrationStatus } from '../../shared/models/application-registration.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../modules/application-registration/services/application-registration.service\";\nimport * as i3 from \"../../modules/nsb-management/services/country.service\";\nimport * as i4 from \"@angular/router\";\nexport let ApplicationRegistrationComponent = /*#__PURE__*/(() => {\n  class ApplicationRegistrationComponent {\n    constructor(fb, applicationRegistrationService, countryService, router) {\n      this.fb = fb;\n      this.applicationRegistrationService = applicationRegistrationService;\n      this.countryService = countryService;\n      this.router = router;\n      this.loading = false;\n      this.saving = false;\n      this.error = '';\n      this.success = false;\n      this.draftSaveSuccess = false;\n      this.countries = [];\n      this.existingApplication = null;\n      this.registrationForm = this.createForm();\n    }\n    ngOnInit() {\n      this.loadCountries();\n      this.checkExistingApplication();\n    }\n    createForm() {\n      return this.fb.group({\n        // Basic Information\n        applicantName: ['', [Validators.required, Validators.minLength(2), Validators.maxLength(200)]],\n        applicantType: ['', [Validators.required, Validators.maxLength(50)]],\n        registrationNumber: ['', [Validators.required, Validators.maxLength(50)]],\n        taxId: ['', Validators.maxLength(30)],\n        contactPerson: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(100)]],\n        contactEmail: ['', [Validators.required, Validators.email, Validators.maxLength(150)]],\n        contactPhone: ['', [Validators.required, Validators.maxLength(20)]],\n        physicalAddress: ['', [Validators.required, Validators.minLength(10), Validators.maxLength(500)]],\n        city: ['', [Validators.required, Validators.minLength(2), Validators.maxLength(100)]],\n        regionState: ['', [Validators.required, Validators.minLength(2), Validators.maxLength(100)]],\n        postalCode: ['', [Validators.required, Validators.minLength(3), Validators.maxLength(20)]],\n        countryId: ['', Validators.required],\n        // Additional Information\n        businessActivity: ['', [Validators.required, Validators.minLength(10), Validators.maxLength(500)]],\n        yearEstablished: [new Date().getFullYear(), [Validators.min(1900), Validators.max(new Date().getFullYear())]],\n        employeeCount: [null, [Validators.min(1)]],\n        annualRevenue: [null, [Validators.min(0)]]\n      });\n    }\n    loadCountries() {\n      this.countryService.getCountries().subscribe({\n        next: countries => {\n          this.countries = countries;\n        },\n        error: error => {\n          console.error('Error loading countries:', error);\n        }\n      });\n    }\n    checkExistingApplication() {\n      this.applicationRegistrationService.getMyApplication().subscribe({\n        next: application => {\n          if (application) {\n            this.existingApplication = application;\n            if (application.status === ApplicationRegistrationStatus.DRAFT) {\n              this.loadApplicationData(application);\n            }\n          }\n        },\n        error: error => {\n          // No existing application, that's fine\n          console.log('No existing application found');\n        }\n      });\n    }\n    loadApplicationData(application) {\n      this.registrationForm.patchValue({\n        applicantName: application.applicantName || '',\n        applicantType: application.applicantType || '',\n        registrationNumber: application.registrationNumber || '',\n        taxId: application.taxId || '',\n        contactPerson: application.contactPerson || '',\n        contactEmail: application.contactEmail || '',\n        contactPhone: application.contactPhone || '',\n        physicalAddress: application.physicalAddress || '',\n        city: application.city || '',\n        regionState: application.regionState || '',\n        postalCode: application.postalCode || '',\n        countryId: application.countryId || '',\n        businessActivity: application.businessActivity || '',\n        yearEstablished: application.yearEstablished || new Date().getFullYear(),\n        employeeCount: application.employeeCount || null,\n        annualRevenue: application.annualRevenue || null\n      });\n    }\n    /**\n     * Cleans form data by converting empty strings to undefined\n     * This ensures the backend receives undefined for optional fields instead of empty strings\n     */\n    cleanFormData(data) {\n      if (data === null || data === undefined) {\n        return undefined;\n      }\n      // Convert empty strings to undefined\n      if (typeof data === 'string' && data.trim() === '') {\n        return undefined;\n      }\n      // Handle objects\n      if (typeof data === 'object' && !(data instanceof Date) && !Array.isArray(data)) {\n        const cleaned = {};\n        let hasValues = false;\n        for (const key in data) {\n          if (data.hasOwnProperty(key)) {\n            const cleanedValue = this.cleanFormData(data[key]);\n            if (cleanedValue !== undefined) {\n              cleaned[key] = cleanedValue;\n              hasValues = true;\n            }\n          }\n        }\n        return hasValues ? cleaned : undefined;\n      }\n      // Return other types as-is (numbers, booleans, dates, arrays, etc.)\n      return data;\n    }\n    /**\n     * Save draft - NO VALIDATION - Allow partial data\n     */\n    saveDraft() {\n      this.saving = true;\n      this.error = '';\n      this.success = false;\n      const formValue = this.registrationForm.value;\n      const cleanedValue = this.cleanFormData(formValue);\n      if (this.existingApplication && this.existingApplication.id) {\n        // Update existing draft\n        this.applicationRegistrationService.updateApplication(this.existingApplication.id, cleanedValue).subscribe({\n          next: application => {\n            this.existingApplication = application;\n            this.saving = false;\n            this.draftSaveSuccess = true;\n            setTimeout(() => {\n              this.draftSaveSuccess = false;\n            }, 3000);\n          },\n          error: error => {\n            this.saving = false;\n            this.error = error.error?.message || 'Failed to save draft. Please try again.';\n            setTimeout(() => {\n              this.error = '';\n            }, 5000);\n          }\n        });\n      } else {\n        // Create new draft\n        this.applicationRegistrationService.saveDraft(cleanedValue).subscribe({\n          next: application => {\n            this.existingApplication = application;\n            this.saving = false;\n            this.draftSaveSuccess = true;\n            setTimeout(() => {\n              this.draftSaveSuccess = false;\n            }, 3000);\n          },\n          error: error => {\n            this.saving = false;\n            this.error = error.error?.message || 'Failed to save draft. Please try again.';\n            setTimeout(() => {\n              this.error = '';\n            }, 5000);\n          }\n        });\n      }\n    }\n    /**\n     * Submit - WITH VALIDATION - All required fields must be filled\n     */\n    onSubmit() {\n      if (this.registrationForm.invalid) {\n        this.markFormGroupTouched(this.registrationForm);\n        this.error = 'Please fill in all required fields correctly';\n        return;\n      }\n      this.loading = true;\n      this.error = '';\n      const formValue = this.registrationForm.value;\n      const cleanedValue = this.cleanFormData(formValue);\n      const payload = {\n        applicantName: cleanedValue.applicantName,\n        applicantType: cleanedValue.applicantType,\n        registrationNumber: cleanedValue.registrationNumber,\n        taxId: cleanedValue.taxId,\n        contactPerson: cleanedValue.contactPerson,\n        contactEmail: cleanedValue.contactEmail,\n        contactPhone: cleanedValue.contactPhone,\n        physicalAddress: cleanedValue.physicalAddress,\n        city: cleanedValue.city,\n        regionState: cleanedValue.regionState,\n        postalCode: cleanedValue.postalCode,\n        countryId: cleanedValue.countryId,\n        businessActivity: cleanedValue.businessActivity,\n        yearEstablished: cleanedValue.yearEstablished,\n        employeeCount: cleanedValue.employeeCount,\n        annualRevenue: cleanedValue.annualRevenue\n      };\n      if (this.existingApplication && this.existingApplication.id) {\n        // Update existing and then submit\n        this.applicationRegistrationService.updateApplication(this.existingApplication.id, payload).subscribe({\n          next: application => {\n            this.existingApplication = application;\n            this.submitApplication(application.id);\n          },\n          error: error => {\n            this.loading = false;\n            this.error = error.error?.message || 'Failed to update registration';\n          }\n        });\n      } else {\n        // Create new and then submit\n        this.applicationRegistrationService.createApplicationRegistration(payload).subscribe({\n          next: application => {\n            this.existingApplication = application;\n            this.submitApplication(application.id);\n          },\n          error: error => {\n            this.loading = false;\n            this.error = error.error?.message || 'Failed to create registration';\n          }\n        });\n      }\n    }\n    submitApplication(applicationId) {\n      this.applicationRegistrationService.submitApplication(applicationId).subscribe({\n        next: () => {\n          this.loading = false;\n          this.success = true;\n          setTimeout(() => {\n            this.router.navigate(['/dashboard']);\n          }, 2000);\n        },\n        error: error => {\n          this.loading = false;\n          this.error = error.error?.message || 'Failed to submit registration';\n        }\n      });\n    }\n    markFormGroupTouched(formGroup) {\n      Object.keys(formGroup.controls).forEach(key => {\n        const control = formGroup.get(key);\n        control?.markAsTouched();\n        if (control instanceof FormGroup) {\n          this.markFormGroupTouched(control);\n        }\n      });\n    }\n    static {\n      this.ɵfac = function ApplicationRegistrationComponent_Factory(t) {\n        return new (t || ApplicationRegistrationComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ApplicationRegistrationService), i0.ɵɵdirectiveInject(i3.CountryService), i0.ɵɵdirectiveInject(i4.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ApplicationRegistrationComponent,\n        selectors: [[\"app-application-registration\"]],\n        decls: 0,\n        vars: 0,\n        template: function ApplicationRegistrationComponent_Template(rf, ctx) {},\n        styles: [\"(()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  {// webpackBootstrap \\\"use strict\\\";})()[_ngcontent-%COMP%] ;{%BLOCK%}\"]\n      });\n    }\n  }\n  return ApplicationRegistrationComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}