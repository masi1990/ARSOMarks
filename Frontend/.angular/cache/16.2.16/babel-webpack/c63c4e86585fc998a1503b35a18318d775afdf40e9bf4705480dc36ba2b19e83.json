{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { finalize } from 'rxjs';\nimport { MarkLicenseStatus } from 'src/app/shared/models/mark-license.model';\nimport { UserRole } from 'src/app/shared/models/user.model';\nexport let MarkLicenseDashboardComponent = class MarkLicenseDashboardComponent {\n  constructor(licenseService, nsbService, authService) {\n    this.licenseService = licenseService;\n    this.nsbService = nsbService;\n    this.authService = authService;\n    this.activeTab = 'applications';\n    this.loading = false;\n    this.error = '';\n    this.nsbId = null;\n    this.isAdminUser = false;\n    this.processingId = null;\n    this.processingAction = null;\n    this.applications = [];\n    this.approvedLicenses = [];\n  }\n  ngOnInit() {\n    const user = this.authService.currentUserValue;\n    const roles = user?.roles || (user?.role ? [user.role] : []);\n    this.isAdminUser = roles.includes(UserRole.SUPER_ADMIN) || roles.includes(UserRole.ARSO_SECRETARIAT);\n    this.loadApplications();\n  }\n  loadApplications() {\n    this.loading = true;\n    this.error = '';\n    if (this.isAdminUser) {\n      this.fetchAllApplications();\n      return;\n    }\n    this.nsbService.getMyNsb().pipe(finalize(() => {\n      this.loading = false;\n    })).subscribe({\n      next: nsb => {\n        this.nsbId = nsb?.id || null;\n        if (!this.nsbId) {\n          this.applications = [];\n          return;\n        }\n        this.fetchApplications(this.nsbId);\n      },\n      error: () => {\n        this.loading = false;\n        this.error = 'Unable to load NSB details.';\n        this.applications = [];\n      }\n    });\n  }\n  fetchApplications(nsbId) {\n    this.loading = true;\n    this.licenseService.getApplicationsByNsb(nsbId, true).pipe(finalize(() => {\n      this.loading = false;\n    })).subscribe({\n      next: applications => {\n        const filtered = (applications || []).filter(app => app.status !== MarkLicenseStatus.DRAFT);\n        this.applications = filtered.map(app => this.mapApplication(app));\n      },\n      error: () => {\n        this.error = 'Unable to load applications.';\n        this.applications = [];\n      }\n    });\n  }\n  fetchAllApplications() {\n    this.loading = true;\n    this.licenseService.getAllApplications(true).pipe(finalize(() => {\n      this.loading = false;\n    })).subscribe({\n      next: applications => {\n        const filtered = (applications || []).filter(app => app.status !== MarkLicenseStatus.DRAFT);\n        this.applications = filtered.map(app => this.mapApplication(app));\n      },\n      error: () => {\n        this.error = 'Unable to load applications.';\n        this.applications = [];\n      }\n    });\n  }\n  mapApplication(app) {\n    return {\n      id: app.id,\n      applicationNumber: app.applicationNumber,\n      submittedAt: app.submittedAt ? new Date(app.submittedAt).toLocaleDateString() : undefined,\n      type: app.licenseTypes?.length ? app.licenseTypes.join(', ') : undefined,\n      status: app.status\n    };\n  }\n  get approvalRequests() {\n    return this.applications.filter(application => application.status === MarkLicenseStatus.SUBMITTED || application.status === MarkLicenseStatus.UNDER_REVIEW);\n  }\n  approveApplication(applicationId) {\n    if (!applicationId || this.processingId) {\n      return;\n    }\n    this.processingId = applicationId;\n    this.processingAction = 'approve';\n    this.licenseService.approveApplication(applicationId).pipe(finalize(() => {\n      this.processingId = null;\n      this.processingAction = null;\n    })).subscribe({\n      next: application => {\n        this.applications = this.applications.map(item => item.id === applicationId ? {\n          ...item,\n          status: application.status\n        } : item);\n      },\n      error: () => {\n        this.error = 'Unable to approve application.';\n      }\n    });\n  }\n  rejectApplication(applicationId) {\n    if (!applicationId || this.processingId) {\n      return;\n    }\n    const reason = window.prompt('Reason for rejection (optional):', '') || undefined;\n    this.processingId = applicationId;\n    this.processingAction = 'reject';\n    this.licenseService.rejectApplication(applicationId, reason).pipe(finalize(() => {\n      this.processingId = null;\n      this.processingAction = null;\n    })).subscribe({\n      next: application => {\n        this.applications = this.applications.map(item => item.id === applicationId ? {\n          ...item,\n          status: application.status\n        } : item);\n      },\n      error: () => {\n        this.error = 'Unable to reject application.';\n      }\n    });\n  }\n};\nMarkLicenseDashboardComponent = __decorate([Component({\n  selector: 'app-mark-license-dashboard',\n  templateUrl: './mark-license-dashboard.component.html',\n  styleUrls: ['./mark-license-dashboard.component.scss']\n})], MarkLicenseDashboardComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}