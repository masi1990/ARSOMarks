{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { RoleRequestStatus, UserRole } from '../../shared/models/user.model';\nexport let RoleDashboardsComponent = class RoleDashboardsComponent {\n  constructor(authService, roleRequestService, router) {\n    this.authService = authService;\n    this.roleRequestService = roleRequestService;\n    this.router = router;\n    this.UserRole = UserRole;\n    this.RoleRequestStatus = RoleRequestStatus;\n    this.user = null;\n    this.pendingRequests = [];\n    this.selectedRoles = new Set();\n    this.disabledRoles = new Set();\n    this.loading = false;\n    this.submitting = false;\n    this.submitError = '';\n    this.submitSuccess = '';\n    this.sidebarLinks = [{\n      label: 'Traceability',\n      description: 'Verify a product instantly by QR/ID',\n      route: '/traceability'\n    }, {\n      label: 'Complaints',\n      description: 'Raise quality or mark misuse cases',\n      route: '/complaints'\n    }, {\n      label: 'Registry',\n      description: 'Search certified products by brand/standard',\n      route: '/'\n    }, {\n      label: 'Help Center',\n      description: 'Guides on roles and onboarding',\n      route: '/'\n    }];\n    this.roleCards = [{\n      role: UserRole.OPERATOR,\n      title: 'Manufacturer / Operator',\n      blurb: 'Request marks, manage products, track certifications.',\n      badge: 'Producers & Operators'\n    }, {\n      role: UserRole.CB_ADMIN,\n      title: 'Certification Body',\n      blurb: 'Plan audits, issue CoCs, oversee certificate lifecycle.',\n      badge: 'CB / Laboratory'\n    }, {\n      role: UserRole.NSB_ADMIN,\n      title: 'National Standards Body',\n      blurb: 'Coordinate approvals, registry oversight, market surveillance.',\n      badge: 'NSB'\n    }];\n  }\n  ngOnInit() {\n    this.user = this.authService.currentUserValue;\n    if (this.redirectIfSpecialized()) {\n      return;\n    }\n    this.refreshProfile();\n    this.loadMyRequests();\n  }\n  toggleRole(role) {\n    if (this.disabledRoles.has(role)) {\n      return;\n    }\n    if (this.selectedRoles.has(role)) {\n      this.selectedRoles.delete(role);\n    } else {\n      this.selectedRoles.add(role);\n    }\n  }\n  isSelected(role) {\n    return this.selectedRoles.has(role);\n  }\n  submitRequests() {\n    this.submitError = '';\n    this.submitSuccess = '';\n    if (!this.selectedRoles.size) {\n      this.submitError = 'Select at least one role to request.';\n      return;\n    }\n    const requestedRoles = Array.from(this.selectedRoles);\n    this.submitting = true;\n    this.roleRequestService.createRequest(requestedRoles).subscribe({\n      next: created => {\n        const createdList = created || [];\n        this.pendingRequests = [...createdList, ...this.pendingRequests];\n        this.selectedRoles = new Set();\n        this.submitSuccess = 'Requests submitted. We will notify you once reviewed.';\n        this.updateDisabledRoles();\n      },\n      error: err => {\n        this.submitError = err?.error?.message || 'Failed to submit your requests.';\n      },\n      complete: () => {\n        this.submitting = false;\n      }\n    });\n  }\n  refreshPending() {\n    this.loadMyRequests();\n  }\n  hasPendingFor(role) {\n    return this.pendingRequests.some(req => req.status === RoleRequestStatus.PENDING && req.requestedRoles.includes(role));\n  }\n  loadMyRequests() {\n    this.loading = true;\n    this.roleRequestService.getMyRequests().subscribe({\n      next: requests => {\n        this.pendingRequests = (requests || []).filter(r => r.status === RoleRequestStatus.PENDING);\n        this.updateDisabledRoles();\n        this.loading = false;\n      },\n      error: () => {\n        this.pendingRequests = [];\n        this.updateDisabledRoles();\n        this.loading = false;\n      }\n    });\n  }\n  refreshProfile() {\n    this.authService.getProfile().subscribe({\n      next: user => {\n        this.user = user;\n        if (!this.redirectIfSpecialized()) {\n          this.updateDisabledRoles();\n        }\n      },\n      error: () => {\n        // Ignore profile errors here to keep the public dashboard accessible.\n      }\n    });\n  }\n  redirectIfSpecialized() {\n    const roles = this.getUserRoles();\n    const nonPublicRoles = roles.filter(role => role !== UserRole.PUBLIC);\n    if (!nonPublicRoles.length) {\n      return false;\n    }\n    if (nonPublicRoles.includes(UserRole.NSB_ADMIN) || nonPublicRoles.includes(UserRole.NSB_USER)) {\n      this.router.navigate(['/portal/nsb/dashboard']);\n      return true;\n    }\n    // Default to the main portal dashboard for all other specialized roles.\n    this.router.navigate(['/portal/dashboard']);\n    return true;\n  }\n  updateDisabledRoles() {\n    const ownedRoles = this.getUserRoles();\n    const pendingRoles = this.pendingRequests.flatMap(r => r.requestedRoles || []);\n    this.disabledRoles = new Set([...ownedRoles, ...pendingRoles]);\n  }\n  getUserRoles() {\n    return this.user?.roles || (this.user?.role ? [this.user.role] : []);\n  }\n};\nRoleDashboardsComponent = __decorate([Component({\n  selector: 'app-role-dashboards',\n  templateUrl: './role-dashboards.component.html',\n  styleUrls: ['./role-dashboards.component.scss']\n})], RoleDashboardsComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}