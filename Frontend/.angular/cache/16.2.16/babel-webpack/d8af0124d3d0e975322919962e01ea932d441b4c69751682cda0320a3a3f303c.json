{"ast":null,"code":"import { HttpParams } from '@angular/common/http';\nimport { catchError, of } from 'rxjs';\nimport { environment } from '../../../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AnalyticsService = /*#__PURE__*/(() => {\n  class AnalyticsService {\n    constructor(http) {\n      this.http = http;\n      this.baseUrl = `${environment.apiBase}/analytics`;\n    }\n    getDashboard(role, filters) {\n      const params = this.buildParams({\n        ...filters,\n        role\n      });\n      const url = `${this.baseUrl}/dashboards/${role.toLowerCase()}`;\n      return this.http.get(url, {\n        params\n      }).pipe(catchError(() => of(this.fallbackDashboard(role))));\n    }\n    getReport(role, filters) {\n      const params = this.buildParams({\n        ...filters,\n        role\n      });\n      const url = `${this.baseUrl}/reports/${role.toLowerCase()}`;\n      return this.http.get(url, {\n        params\n      }).pipe(catchError(() => of(this.fallbackReport(role))));\n    }\n    buildParams(filters) {\n      let params = new HttpParams();\n      if (!filters) return params;\n      Object.entries(filters).forEach(([key, value]) => {\n        if (value !== undefined && value !== null && value !== '') {\n          params = params.set(key, String(value));\n        }\n      });\n      return params;\n    }\n    fallbackDashboard(role) {\n      const kpis = [{\n        id: 'active',\n        label: 'Active',\n        value: 124,\n        trend: {\n          direction: 'up',\n          change: 8,\n          period: '30d'\n        }\n      }, {\n        id: 'pending',\n        label: 'Pending',\n        value: 32,\n        trend: {\n          direction: 'down',\n          change: 4,\n          period: '30d'\n        }\n      }, {\n        id: 'expiring',\n        label: 'Expiring <60d',\n        value: 14,\n        helperText: 'Prioritize renewals'\n      }, {\n        id: 'alerts',\n        label: 'Open Alerts',\n        value: 7,\n        trend: {\n          direction: 'up',\n          change: 2,\n          period: '7d'\n        }\n      }];\n      const trends = [{\n        id: 'volume',\n        label: 'Volume over time',\n        points: this.buildTrendPoints()\n      }, {\n        id: 'sla',\n        label: 'SLA adherence',\n        points: this.buildTrendPoints(90)\n      }];\n      const alerts = [{\n        id: 'a1',\n        title: 'Renewals approaching',\n        severity: 'warning',\n        description: '14 certificates expire in <60 days'\n      }, {\n        id: 'a2',\n        title: 'Open complaints',\n        severity: 'critical',\n        description: '5 complaints unresolved > 15 days'\n      }];\n      const pending = [{\n        id: 'p1',\n        title: 'Applications to review',\n        description: '9 awaiting decision',\n        status: 'pending'\n      }, {\n        id: 'p2',\n        title: 'Audits to schedule',\n        description: '3 audits missing dates',\n        status: 'in_progress'\n      }];\n      return {\n        role,\n        kpis,\n        trends,\n        alerts,\n        pending,\n        breakdowns: [{\n          id: 'b1',\n          label: 'By region',\n          value: 42,\n          extra: 'EA'\n        }, {\n          id: 'b2',\n          label: 'By scheme',\n          value: 58,\n          extra: 'Mark'\n        }]\n      };\n    }\n    fallbackReport(role) {\n      const summary = [{\n        id: 'total',\n        label: 'Total records',\n        value: 240\n      }, {\n        id: 'completed',\n        label: 'Completed',\n        value: 180,\n        trend: {\n          direction: 'up',\n          change: 6,\n          period: '30d'\n        }\n      }, {\n        id: 'open',\n        label: 'Open items',\n        value: 24\n      }];\n      return {\n        role,\n        summary,\n        rows: [{\n          label: 'Pending approvals',\n          value: 12,\n          status: 'pending'\n        }, {\n          label: 'In review',\n          value: 8,\n          status: 'in_progress'\n        }, {\n          label: 'Closed this month',\n          value: 36,\n          status: 'done'\n        }],\n        trends: [{\n          id: 'trend',\n          label: 'Throughput',\n          points: this.buildTrendPoints(50)\n        }]\n      };\n    }\n    buildTrendPoints(base = 120) {\n      const today = new Date();\n      return Array.from({\n        length: 6\n      }).map((_, idx) => {\n        const d = new Date(today);\n        d.setMonth(d.getMonth() - (5 - idx));\n        return {\n          label: d.toLocaleDateString('en-US', {\n            month: 'short'\n          }),\n          value: Math.max(5, Math.round(base + Math.random() * 20 - 10))\n        };\n      });\n    }\n    static {\n      this.ɵfac = function AnalyticsService_Factory(t) {\n        return new (t || AnalyticsService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AnalyticsService,\n        factory: AnalyticsService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AnalyticsService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}