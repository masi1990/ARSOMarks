{"ast":null,"code":"import { UserRole } from '../../shared/models/user.model';\nexport class StakeholderRegistryListComponent {\n  constructor(nsbService, stakeholderService, authService, router) {\n    this.nsbService = nsbService;\n    this.stakeholderService = stakeholderService;\n    this.authService = authService;\n    this.router = router;\n    this.stakeholders = [];\n    this.filteredStakeholders = [];\n    this.nsbs = [];\n    this.loading = false;\n    this.error = '';\n    this.searchQuery = '';\n    this.filterType = 'ALL';\n    this.currentPage = 1;\n    this.itemsPerPage = 10;\n    this.totalPages = 1;\n  }\n  ngOnInit() {\n    this.loadRegistries();\n  }\n  loadRegistries() {\n    this.loading = true;\n    this.error = '';\n    const user = this.authService.currentUserValue;\n    const userRoles = user?.roles || (user?.role ? [user.role] : []);\n    const isSuperAdmin = userRoles.includes(UserRole.SUPER_ADMIN) || userRoles.includes(UserRole.ARSO_SECRETARIAT);\n    if (isSuperAdmin) {\n      // Super admins can see all NSBs\n      this.nsbService.getNsbList({\n        limit: 1000\n      }).subscribe({\n        next: response => {\n          this.nsbs = response.data || [];\n          this.applyFilters();\n          this.loading = false;\n        },\n        error: () => {\n          this.error = 'Failed to load stakeholder registries.';\n          this.loading = false;\n        }\n      });\n    } else if (userRoles.includes(UserRole.NSB_ADMIN)) {\n      // NSB admins can only see their own NSB\n      this.nsbService.getMyNsb().subscribe({\n        next: nsb => {\n          this.nsbs = nsb ? [nsb] : [];\n          this.applyFilters();\n          this.loading = false;\n        },\n        error: () => {\n          this.error = 'Failed to load your stakeholder registry.';\n          this.loading = false;\n        }\n      });\n    } else {\n      this.error = 'You do not have permission to view stakeholder registries.';\n      this.loading = false;\n    }\n  }\n  applyFilters() {\n    let filtered = [...this.nsbs];\n    // Apply status filter\n    if (this.filterStatus !== 'ALL') {\n      filtered = filtered.filter(nsb => nsb.stakeholderRegistryStatus === this.filterStatus);\n    }\n    // Apply search filter\n    if (this.searchQuery.trim()) {\n      const query = this.searchQuery.toLowerCase();\n      filtered = filtered.filter(nsb => nsb.name?.toLowerCase().includes(query) || nsb.shortName?.toLowerCase().includes(query) || nsb.country?.name?.toLowerCase().includes(query));\n    }\n    // Calculate total pages before pagination\n    this.totalPages = Math.ceil(filtered.length / this.itemsPerPage);\n    // Apply pagination\n    const startIndex = (this.currentPage - 1) * this.itemsPerPage;\n    const endIndex = startIndex + this.itemsPerPage;\n    this.filteredNsbs = filtered.slice(startIndex, endIndex);\n  }\n  onSearchChange() {\n    this.currentPage = 1;\n    this.applyFilters();\n  }\n  getPageNumbers() {\n    const pages = [];\n    const maxPages = Math.min(5, this.totalPages);\n    let startPage = Math.max(1, this.currentPage - Math.floor(maxPages / 2));\n    let endPage = Math.min(this.totalPages, startPage + maxPages - 1);\n    if (endPage - startPage < maxPages - 1) {\n      startPage = Math.max(1, endPage - maxPages + 1);\n    }\n    for (let i = startPage; i <= endPage; i++) {\n      pages.push(i);\n    }\n    return pages;\n  }\n  goToPage(page) {\n    this.currentPage = page;\n    this.applyFilters();\n  }\n  previousPage() {\n    if (this.currentPage > 1) {\n      this.currentPage--;\n      this.applyFilters();\n    }\n  }\n  nextPage() {\n    if (this.currentPage < this.totalPages) {\n      this.currentPage++;\n      this.applyFilters();\n    }\n  }\n  getDisplayRange() {\n    const totalFiltered = this.getTotalFilteredCount();\n    const start = totalFiltered > 0 ? (this.currentPage - 1) * this.itemsPerPage + 1 : 0;\n    const end = Math.min(this.currentPage * this.itemsPerPage, totalFiltered);\n    return totalFiltered > 0 ? `${start} to ${end}` : '0';\n  }\n  getTotalFilteredCount() {\n    let filtered = [...this.nsbs];\n    if (this.filterStatus !== 'ALL') {\n      filtered = filtered.filter(nsb => nsb.stakeholderRegistryStatus === this.filterStatus);\n    }\n    if (this.searchQuery.trim()) {\n      const query = this.searchQuery.toLowerCase();\n      filtered = filtered.filter(nsb => nsb.name?.toLowerCase().includes(query) || nsb.shortName?.toLowerCase().includes(query) || nsb.country?.name?.toLowerCase().includes(query));\n    }\n    return filtered.length;\n  }\n  getCountryCode(nsb) {\n    return nsb.country?.isoCode || 'N/A';\n  }\n  calculateReadiness(nsb) {\n    // Calculate readiness percentage based on NSB profile completion\n    let score = 0;\n    if (nsb.name) score += 20;\n    if (nsb.contacts && nsb.contacts.length > 0) score += 20;\n    if (nsb.locations && nsb.locations.length > 0) score += 20;\n    if (nsb.documents && nsb.documents.length > 0) score += 20;\n    if (nsb.stakeholderRegistryStatus === 'SUBMITTED') score += 20;\n    return Math.min(100, score);\n  }\n  getCertificationCount(nsb) {\n    // TODO: Get actual certification count from licensing module\n    // For now, return mock data based on NSB status\n    if (nsb.status === 'ACTIVE' && nsb.stakeholderRegistryStatus === 'SUBMITTED') {\n      return Math.floor(Math.random() * 500) + 100;\n    }\n    return 0;\n  }\n  getStatusBadgeClass(status) {\n    switch (status) {\n      case 'SUBMITTED':\n        return 'bg-emerald-100 text-emerald-800 border-emerald-200';\n      case 'DRAFT':\n        return 'bg-yellow-100 text-yellow-800 border-yellow-200';\n      default:\n        return 'bg-slate-100 text-slate-800 border-slate-200';\n    }\n  }\n  getStatusLabel(status) {\n    switch (status) {\n      case 'SUBMITTED':\n        return 'Submitted';\n      case 'DRAFT':\n        return 'Draft';\n      default:\n        return 'Not Started';\n    }\n  }\n  viewRegistry(nsb) {\n    // Navigate to NSB management page with the NSB ID\n    this.router.navigate(['/portal/nsb'], {\n      queryParams: {\n        id: nsb.id\n      }\n    });\n  }\n  navigateToMarks(nsb) {\n    // Navigate to mark licensing dashboard\n    this.router.navigate(['/portal/mark-licenses/dashboard'], {\n      queryParams: {\n        nsbId: nsb.id\n      }\n    });\n  }\n  navigateToSettings(nsb) {\n    // Navigate to NSB management page for configuration\n    this.router.navigate(['/portal/nsb'], {\n      queryParams: {\n        id: nsb.id\n      }\n    });\n  }\n  formatDate(dateString) {\n    if (!dateString) return '-';\n    const date = new Date(dateString);\n    return date.toLocaleDateString('en-US', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  }\n}","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}