{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { finalize } from 'rxjs';\nimport { AssetDeliveryMethod } from '../../shared/models/mark-license.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../../modules/mark-licensing/services/mark-license-agreement.service\";\nimport * as i3 from \"../../modules/mark-licensing/services/mark-asset.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"../../modules/auth/services/auth.service\";\nexport let MarkLicenseAgreementComponent = /*#__PURE__*/(() => {\n  class MarkLicenseAgreementComponent {\n    constructor(fb, agreementService, assetService, route, router, authService) {\n      this.fb = fb;\n      this.agreementService = agreementService;\n      this.assetService = assetService;\n      this.route = route;\n      this.router = router;\n      this.authService = authService;\n      this.agreement = null;\n      this.loading = false;\n      this.signing = false;\n      this.requestingAssets = false;\n      this.error = '';\n      this.success = false;\n      this.successMessage = '';\n      this.agreementId = null;\n      this.showAssetRequest = false;\n      // Asset delivery method options\n      this.deliveryMethodOptions = [{\n        value: AssetDeliveryMethod.PORTAL_DOWNLOAD,\n        label: 'Download from Portal'\n      }, {\n        value: AssetDeliveryMethod.EMAIL_DELIVERY,\n        label: 'Email Delivery'\n      }, {\n        value: AssetDeliveryMethod.PHYSICAL_MEDIA,\n        label: 'Physical Media'\n      }, {\n        value: AssetDeliveryMethod.OTHER,\n        label: 'Other'\n      }];\n      // Requested asset options\n      this.assetOptions = [{\n        value: 'VECTOR_AI',\n        label: 'Vector Files (AI)'\n      }, {\n        value: 'VECTOR_EPS',\n        label: 'Vector Files (EPS)'\n      }, {\n        value: 'PNG',\n        label: 'PNG Files'\n      }, {\n        value: 'JPEG',\n        label: 'JPEG Files'\n      }, {\n        value: 'BRAND_GUIDELINES_PDF',\n        label: 'Brand Guidelines PDF'\n      }, {\n        value: 'USAGE_EXAMPLES',\n        label: 'Usage Examples'\n      }, {\n        value: 'SOCIAL_MEDIA_KIT',\n        label: 'Social Media Kit'\n      }, {\n        value: 'VIDEO_FILES',\n        label: 'Video Files'\n      }];\n      this.signForm = this.fb.group({\n        nsbSignerName: ['', [Validators.required]],\n        nsbSignerTitle: ['', [Validators.required]],\n        nsbSignerEmail: ['', [Validators.required, Validators.email]],\n        nsbSignerConsent: [false, [Validators.requiredTrue]]\n      });\n      this.assetRequestForm = this.fb.group({\n        requestedAssets: [[], [Validators.required]],\n        assetDeliveryMethod: ['', [Validators.required]],\n        assetRecipientName: ['', [Validators.required]],\n        assetRecipientEmail: ['', [Validators.required, Validators.email]],\n        assetUseConfirmation: [false, [Validators.requiredTrue]]\n      });\n    }\n    ngOnInit() {\n      this.route.params.subscribe(params => {\n        this.agreementId = params['id'];\n        if (this.agreementId) {\n          this.loadAgreement();\n        }\n      });\n    }\n    loadAgreement() {\n      if (!this.agreementId) return;\n      this.loading = true;\n      this.agreementService.getAgreementById(this.agreementId).pipe(finalize(() => {\n        this.loading = false;\n      })).subscribe({\n        next: agreement => {\n          this.agreement = agreement;\n          // Pre-fill sign form if agreement is pending NSB signature\n          if (agreement.agreementStatus === 'PENDING_NSB') {\n            this.signForm.patchValue({\n              nsbSignerName: agreement.nsbSignerName,\n              nsbSignerTitle: agreement.nsbSignerTitle,\n              nsbSignerEmail: agreement.nsbSignerEmail\n            });\n          }\n        },\n        error: err => {\n          this.error = err.error?.message || 'Failed to load agreement.';\n        }\n      });\n    }\n    signAgreement() {\n      if (this.signForm.invalid || !this.agreementId) {\n        this.markFormGroupTouched(this.signForm);\n        this.error = 'Please fill in all required fields correctly.';\n        return;\n      }\n      this.signing = true;\n      this.error = '';\n      const payload = this.signForm.value;\n      this.agreementService.signAgreement(this.agreementId, payload).pipe(finalize(() => {\n        this.signing = false;\n      })).subscribe({\n        next: agreement => {\n          this.agreement = agreement;\n          this.success = true;\n          this.successMessage = 'Agreement signed successfully! Waiting for ARSO signature.';\n          setTimeout(() => {\n            this.success = false;\n          }, 5000);\n        },\n        error: err => {\n          this.error = err.error?.message || 'Failed to sign agreement. Please try again.';\n        }\n      });\n    }\n    requestAssets() {\n      if (this.assetRequestForm.invalid || !this.agreementId) {\n        this.markFormGroupTouched(this.assetRequestForm);\n        this.error = 'Please fill in all required fields correctly.';\n        return;\n      }\n      this.requestingAssets = true;\n      this.error = '';\n      const payload = {\n        agreementId: this.agreementId,\n        ...this.assetRequestForm.value\n      };\n      this.assetService.requestAssets(payload).pipe(finalize(() => {\n        this.requestingAssets = false;\n      })).subscribe({\n        next: () => {\n          this.success = true;\n          this.successMessage = 'Asset request submitted successfully!';\n          this.showAssetRequest = false;\n          this.assetRequestForm.reset();\n          setTimeout(() => {\n            this.success = false;\n          }, 5000);\n        },\n        error: err => {\n          this.error = err.error?.message || 'Failed to request assets. Please try again.';\n        }\n      });\n    }\n    canSign() {\n      return this.agreement?.agreementStatus === 'PENDING_NSB';\n    }\n    isExecuted() {\n      return this.agreement?.agreementStatus === 'EXECUTED';\n    }\n    isPendingArso() {\n      return this.agreement?.agreementStatus === 'PENDING_ARSO';\n    }\n    getStatusBadgeClass() {\n      if (!this.agreement) return '';\n      switch (this.agreement.agreementStatus) {\n        case 'EXECUTED':\n          return 'bg-emerald-100 text-emerald-800';\n        case 'PENDING_NSB':\n          return 'bg-amber-100 text-amber-800';\n        case 'PENDING_ARSO':\n          return 'bg-blue-100 text-blue-800';\n        case 'DRAFT':\n          return 'bg-slate-100 text-slate-800';\n        default:\n          return 'bg-gray-100 text-gray-800';\n      }\n    }\n    getStatusLabel() {\n      if (!this.agreement) return '';\n      switch (this.agreement.agreementStatus) {\n        case 'EXECUTED':\n          return 'Executed';\n        case 'PENDING_NSB':\n          return 'Pending NSB Signature';\n        case 'PENDING_ARSO':\n          return 'Pending ARSO Signature';\n        case 'DRAFT':\n          return 'Draft';\n        default:\n          return this.agreement.agreementStatus;\n      }\n    }\n    formatDate(dateString) {\n      if (!dateString) return '';\n      const date = new Date(dateString);\n      return date.toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'long',\n        day: 'numeric'\n      });\n    }\n    calculateDaysRemaining() {\n      if (!this.agreement?.licenseEndDate) return 0;\n      const endDate = new Date(this.agreement.licenseEndDate);\n      const today = new Date();\n      const diffTime = endDate.getTime() - today.getTime();\n      return Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    }\n    markFormGroupTouched(formGroup) {\n      Object.keys(formGroup.controls).forEach(key => {\n        const control = formGroup.get(key);\n        control?.markAsTouched();\n      });\n    }\n    toggleAssetRequest() {\n      this.showAssetRequest = !this.showAssetRequest;\n      if (this.showAssetRequest && this.agreement) {\n        // Pre-fill recipient info from agreement\n        this.assetRequestForm.patchValue({\n          assetRecipientName: this.agreement.nsbSignerName,\n          assetRecipientEmail: this.agreement.nsbSignerEmail\n        });\n      }\n    }\n    downloadAgreement() {\n      if (this.agreement?.agreementDocumentPath) {\n        // In a real implementation, this would download the PDF\n        window.open(this.agreement.agreementDocumentPath, '_blank');\n      }\n    }\n    static {\n      this.ɵfac = function MarkLicenseAgreementComponent_Factory(t) {\n        return new (t || MarkLicenseAgreementComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MarkLicenseAgreementService), i0.ɵɵdirectiveInject(i3.MarkAssetService), i0.ɵɵdirectiveInject(i4.ActivatedRoute), i0.ɵɵdirectiveInject(i4.Router), i0.ɵɵdirectiveInject(i5.AuthService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: MarkLicenseAgreementComponent,\n        selectors: [[\"app-mark-license-agreement\"]],\n        decls: 0,\n        vars: 0,\n        template: function MarkLicenseAgreementComponent_Template(rf, ctx) {},\n        styles: [\"(()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  {// webpackBootstrap \\\"use strict\\\";})()[_ngcontent-%COMP%] ;{%BLOCK%}\"]\n      });\n    }\n  }\n  return MarkLicenseAgreementComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}