{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { FormControl } from '@angular/forms';\nexport let TraceabilityVerifyComponent = class TraceabilityVerifyComponent {\n  constructor(route, api) {\n    this.route = route;\n    this.api = api;\n    this.tokenControl = new FormControl('');\n    this.loading = false;\n    this.error = '';\n    this.geoHeaders = {};\n  }\n  ngOnInit() {\n    this.tryGeo();\n    const tokenFromQuery = this.route.snapshot.queryParamMap.get('token');\n    if (tokenFromQuery) {\n      const cleaned = this.extractToken(tokenFromQuery);\n      this.tokenControl.setValue(cleaned);\n      this.verify(cleaned);\n    }\n  }\n  verify(token) {\n    const value = token ?? this.tokenControl.value;\n    if (!value) {\n      this.error = 'Provide a token from the QR code link.';\n      return;\n    }\n    this.loading = true;\n    this.error = '';\n    this.api.verifyToken(this.extractToken(value), this.geoHeaders).subscribe({\n      next: res => {\n        this.result = res;\n        this.loading = false;\n      },\n      error: err => {\n        this.error = err.error?.message || 'Verification failed.';\n        this.loading = false;\n      }\n    });\n  }\n  statusColor(status) {\n    switch (status) {\n      case 'VALID':\n      case 'ISSUED':\n        return 'text-green-700 bg-green-50';\n      case 'EXPIRED':\n        return 'text-amber-700 bg-amber-50';\n      case 'REVOKED':\n        return 'text-red-700 bg-red-50';\n      default:\n        return 'text-slate-700 bg-slate-100';\n    }\n  }\n  qrImage(url) {\n    if (!url) return '';\n    return `https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=${encodeURIComponent(url)}`;\n  }\n  extractToken(raw) {\n    if (!raw) return raw;\n    if (raw.includes('token=')) {\n      const url = new URL(raw, window.location.origin);\n      return url.searchParams.get('token') || raw;\n    }\n    return raw;\n  }\n  tryGeo() {\n    if (!navigator?.geolocation) return;\n    navigator.geolocation.getCurrentPosition(pos => {\n      this.geoHeaders = {\n        lat: pos.coords.latitude,\n        lon: pos.coords.longitude\n      };\n    }, () => {}, {\n      maximumAge: 300000,\n      timeout: 3000\n    });\n  }\n};\nTraceabilityVerifyComponent = __decorate([Component({\n  selector: 'app-traceability-verify',\n  templateUrl: './traceability-verify.component.html',\n  styleUrls: ['./traceability-verify.component.scss']\n})], TraceabilityVerifyComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}