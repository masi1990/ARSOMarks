{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport { finalize } from 'rxjs/operators';\nimport { LicenseDurationType, MarkLicenseType } from 'src/app/shared/models/mark-license.model';\nimport { UserRole } from 'src/app/shared/models/user.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"src/app/modules/nsb-management/services/nsb.service\";\nimport * as i3 from \"src/app/modules/auth/services/auth.service\";\nimport * as i4 from \"src/app/modules/mark-licensing/services/mark-license-application.service\";\nimport * as i5 from \"@angular/router\";\nimport * as i6 from \"@angular/common\";\nfunction MarkLicenseApplicationComponent_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.error, \" \");\n  }\n}\nfunction MarkLicenseApplicationComponent_div_28_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 38);\n    i0.ɵɵtext(1, \" Loading NSB profile... \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction MarkLicenseApplicationComponent_div_28_span_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" , \", (ctx_r5.nsbProfile == null ? null : ctx_r5.nsbProfile.headquartersAddress == null ? null : ctx_r5.nsbProfile.headquartersAddress.city) || (ctx_r5.nsbProfile == null ? null : ctx_r5.nsbProfile.postalAddress == null ? null : ctx_r5.nsbProfile.postalAddress.city), \" \");\n  }\n}\nfunction MarkLicenseApplicationComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtemplate(1, MarkLicenseApplicationComponent_div_28_div_1_Template, 2, 0, \"div\", 25);\n    i0.ɵɵelementStart(2, \"div\", 26)(3, \"h2\", 27);\n    i0.ɵɵtext(4, \"NSB Registration Profile\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\", 28);\n    i0.ɵɵtext(6, \"Please review your National Standards Body profile details. These details will be associated with your license application.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"div\", 29)(8, \"div\", 30)(9, \"label\", 31);\n    i0.ɵɵtext(10, \"Organization Name\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 32);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"div\", 30)(14, \"label\", 31);\n    i0.ɵɵtext(15, \"Country\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"div\", 32);\n    i0.ɵɵtext(17);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(18, \"div\", 30)(19, \"label\", 31);\n    i0.ɵɵtext(20, \"Official Email\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"div\", 32);\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(23, \"div\", 30)(24, \"label\", 31);\n    i0.ɵɵtext(25, \"Registration Number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\", 32);\n    i0.ɵɵtext(27);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(28, \"div\", 33)(29, \"label\", 31);\n    i0.ɵɵtext(30, \"Address\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(31, \"div\", 32);\n    i0.ɵɵtext(32);\n    i0.ɵɵtemplate(33, MarkLicenseApplicationComponent_div_28_span_33_Template, 2, 1, \"span\", 34);\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(34, \"div\", 35)(35, \"button\", 36);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_28_Template_button_click_35_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r6 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r6.saveDraft());\n    });\n    i0.ɵɵtext(36, \"Save Draft\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(37, \"button\", 37);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_28_Template_button_click_37_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.nextStep());\n    });\n    i0.ɵɵtext(38, \"Next: License Details\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.loading);\n    i0.ɵɵadvance(11);\n    i0.ɵɵtextInterpolate((ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.nsbOfficialName) || \"N/A\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate((ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.countryName) || \"N/A\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate((ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.contactEmail) || \"N/A\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate((ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.registrationNumber) || \"N/A\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", (ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.headquartersAddress == null ? null : ctx_r1.nsbProfile.headquartersAddress.addressLine1) || (ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.postalAddress == null ? null : ctx_r1.nsbProfile.postalAddress.addressLine1) || \"N/A\", \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.headquartersAddress == null ? null : ctx_r1.nsbProfile.headquartersAddress.city) || (ctx_r1.nsbProfile == null ? null : ctx_r1.nsbProfile.postalAddress == null ? null : ctx_r1.nsbProfile.postalAddress.city));\n  }\n}\nfunction MarkLicenseApplicationComponent_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"form\", 39)(2, \"div\", 26)(3, \"h2\", 27);\n    i0.ɵɵtext(4, \"License Type(s) Requested \");\n    i0.ɵɵelementStart(5, \"span\", 40);\n    i0.ɵɵtext(6, \"*\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 41)(8, \"div\", 42)(9, \"label\", 43);\n    i0.ɵɵelement(10, \"input\", 44);\n    i0.ɵɵelementStart(11, \"div\", 45)(12, \"span\", 46);\n    i0.ɵɵtext(13, \"Promotional/Institutional License\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"p\", 47);\n    i0.ɵɵtext(15, \"For organizations wishing to use the mark for promotional purposes without certifying specific products.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"div\", 48);\n    i0.ɵɵtext(17, \" \\\"4.6 Publicly available information... a description of the rights and duties of applicants and clients, including requirements, restrictions or limitations on the use of the certification body's name and certification mark...\\\" (ISO/IEC 17065:2012) \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(18, \"div\", 42)(19, \"label\", 43);\n    i0.ɵɵelement(20, \"input\", 49);\n    i0.ɵɵelementStart(21, \"div\", 45)(22, \"span\", 46);\n    i0.ɵɵtext(23, \"Certification Body License\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"p\", 47);\n    i0.ɵɵtext(25, \"For bodies operating product certification schemes.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(26, \"div\", 48);\n    i0.ɵɵtext(27, \" \\\"4.1.1 Legal responsibility: The certification body shall be a legal entity, or a defined part of a legal entity, such that the legal entity can be held legally responsible for all its certification activities.\\\" (ISO/IEC 17065:2012) \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(28, \"div\", 42)(29, \"label\", 43);\n    i0.ɵɵelement(30, \"input\", 50);\n    i0.ɵɵelementStart(31, \"div\", 45)(32, \"span\", 46);\n    i0.ɵɵtext(33, \"Special Project License\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"p\", 47);\n    i0.ɵɵtext(35, \"For specific, time-bound projects requiring mark usage.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(36, \"div\", 48);\n    i0.ɵɵtext(37, \" \\\"4.1.2 Certification agreement... The certification body shall have a legally enforceable agreement for the provision of certification activities to its clients.\\\" (ISO/IEC 17065:2012) \");\n    i0.ɵɵelementEnd()()()()()();\n    i0.ɵɵelementStart(38, \"div\", 26)(39, \"h2\", 27);\n    i0.ɵɵtext(40, \"Section C: Mark Usage Specifications\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(41, \"p\", 51);\n    i0.ɵɵtext(42, \"Please confirm adherence to the following requirements based on ISO/IEC 17065:2012.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(43, \"div\", 41)(44, \"div\", 52)(45, \"label\", 43);\n    i0.ɵɵelement(46, \"input\", 53);\n    i0.ɵɵelementStart(47, \"div\", 45)(48, \"span\", 54);\n    i0.ɵɵtext(49, \"Compliance with Certification Agreement\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(50, \"div\", 55);\n    i0.ɵɵtext(51, \" \\\"4.1.2.2 ...the client complies at least, with the following: a) the client always fulfils the certification requirements... b) if the certification applies to ongoing production, the certified product continues to fulfil the product requirements...\\\" \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(52, \"div\", 52)(53, \"label\", 43);\n    i0.ɵɵelement(54, \"input\", 56);\n    i0.ɵɵelementStart(55, \"div\", 45)(56, \"span\", 54);\n    i0.ɵɵtext(57, \"Control of Mark Usage\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(58, \"div\", 55);\n    i0.ɵɵtext(59, \" \\\"4.1.3.1 The certification body shall exercise the control as specified by the certification scheme over ownership, use and display of licenses, certificates, marks of conformity, and any other mechanisms for indicating a product is certified.\\\" \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(60, \"div\", 52)(61, \"label\", 43);\n    i0.ɵɵelement(62, \"input\", 57);\n    i0.ɵɵelementStart(63, \"div\", 45)(64, \"span\", 54);\n    i0.ɵɵtext(65, \"Prevention of Misleading Statements\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(66, \"div\", 55);\n    i0.ɵɵtext(67, \" \\\"4.1.2.2 e) the client does not use its product certification in such a manner as to bring the certification body into disrepute and does not make any statement regarding its product certification that the certification body may consider misleading or unauthorized...\\\" \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵelementStart(68, \"div\", 52)(69, \"label\", 43);\n    i0.ɵɵelement(70, \"input\", 58);\n    i0.ɵɵelementStart(71, \"div\", 45)(72, \"span\", 54);\n    i0.ɵɵtext(73, \"Notification of Changes\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(74, \"div\", 55);\n    i0.ɵɵtext(75, \" \\\"4.1.2.2 k) the client informs the certification body, without delay, of changes that may affect its ability to conform with the certification requirements.\\\" \");\n    i0.ɵɵelementEnd()()()()()()();\n    i0.ɵɵelementStart(76, \"div\", 59)(77, \"button\", 60);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_29_Template_button_click_77_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.prevStep());\n    });\n    i0.ɵɵtext(78, \"Back\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(79, \"div\", 61)(80, \"button\", 36);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_29_Template_button_click_80_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r11 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r11.saveDraft());\n    });\n    i0.ɵɵtext(81, \"Save Draft\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(82, \"button\", 37);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_29_Template_button_click_82_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r12 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r12.nextStep());\n    });\n    i0.ɵɵtext(83, \"Next: Review\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"formGroup\", ctx_r2.applicationForm);\n  }\n}\nfunction MarkLicenseApplicationComponent_div_30_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r14 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 24)(1, \"div\", 62)(2, \"div\", 63);\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(3, \"svg\", 64);\n    i0.ɵɵelement(4, \"path\", 65);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelementStart(5, \"h2\", 66);\n    i0.ɵɵtext(6, \"Ready to Submit\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"p\", 28);\n    i0.ɵɵtext(8, \"Please verify all information before final submission. Once submitted, the application will be reviewed by ARSO administrators.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 67)(10, \"h3\", 68);\n    i0.ɵɵtext(11, \"Summary\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"p\", 69)(13, \"span\", 70);\n    i0.ɵɵtext(14, \"Applicant:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(16, \"p\", 69)(17, \"span\", 70);\n    i0.ɵɵtext(18, \"License Types:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(19);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(20, \"p\")(21, \"span\", 70);\n    i0.ɵɵtext(22, \"Agreements:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(23, \" All Section C requirements accepted.\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(24, \"div\", 59)(25, \"button\", 60);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_30_Template_button_click_25_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r13 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r13.prevStep());\n    });\n    i0.ɵɵtext(26, \"Back\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"div\", 61)(28, \"button\", 36);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_30_Template_button_click_28_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r15 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r15.saveDraft());\n    });\n    i0.ɵɵtext(29, \"Save Draft\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(30, \"button\", 71);\n    i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_div_30_Template_button_click_30_listener() {\n      i0.ɵɵrestoreView(_r14);\n      const ctx_r16 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r16.submitApplication());\n    });\n    i0.ɵɵtext(31, \"Submit Application\");\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    let tmp_1_0;\n    i0.ɵɵadvance(15);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r3.nsbProfile == null ? null : ctx_r3.nsbProfile.organizationName, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate3(\" \", ((tmp_1_0 = ctx_r3.applicationForm.get(\"promotionalLicense\")) == null ? null : tmp_1_0.value) ? \"Promotional, \" : \"\", \" \", ((tmp_1_0 = ctx_r3.applicationForm.get(\"certificationBodyLicense\")) == null ? null : tmp_1_0.value) ? \"Certification Body, \" : \"\", \" \", ((tmp_1_0 = ctx_r3.applicationForm.get(\"specialProjectLicense\")) == null ? null : tmp_1_0.value) ? \"Special Project\" : \"\", \" \");\n  }\n}\nconst _c0 = function (a0, a1) {\n  return {\n    \"bg-blue-600 text-white\": a0,\n    \"bg-gray-200 text-gray-500\": a1\n  };\n};\nconst _c1 = function (a0, a1) {\n  return {\n    \"text-blue-600\": a0,\n    \"text-gray-500\": a1\n  };\n};\nexport let MarkLicenseApplicationComponent = /*#__PURE__*/(() => {\n  class MarkLicenseApplicationComponent {\n    constructor(fb, nsbService, authService, licenseService, router) {\n      this.fb = fb;\n      this.nsbService = nsbService;\n      this.authService = authService;\n      this.licenseService = licenseService;\n      this.router = router;\n      this.currentStep = 1;\n      this.nsbOptions = [];\n      this.selectedNsb = null;\n      this.loading = false;\n      this.loadingNsbs = false;\n      this.saving = false;\n      this.submitting = false;\n      this.error = '';\n      this.existingApplication = null;\n      this.initForm();\n    }\n    ngOnInit() {\n      this.loadNsbs();\n    }\n    initForm() {\n      this.applicationForm = this.fb.group({\n        nsbId: ['', Validators.required],\n        // License Types - Default unchecked\n        promotionalLicense: [false],\n        certificationBodyLicense: [false],\n        specialProjectLicense: [false],\n        // Section C Compliance - Default unchecked\n        agreementCompliance: [false, Validators.requiredTrue],\n        markUsageCompliance: [false, Validators.requiredTrue],\n        misleadingStatementsCompliance: [false, Validators.requiredTrue],\n        changesCompliance: [false, Validators.requiredTrue]\n      });\n    }\n    loadNsbs() {\n      this.loadingNsbs = true;\n      const user = this.authService.currentUserValue;\n      const userRoles = user?.roles || (user?.role ? [user.role] : []);\n      const isAdmin = userRoles.includes(UserRole.SUPER_ADMIN) || userRoles.includes(UserRole.ARSO_SECRETARIAT);\n      const request = isAdmin ? this.nsbService.getNsbList({\n        limit: 1000\n      }) : user?.countryId ? this.nsbService.getNsbList({\n        countryId: user.countryId,\n        limit: 1000\n      }) : this.nsbService.getMyNsb();\n      request.pipe(finalize(() => {\n        this.loadingNsbs = false;\n      })).subscribe({\n        next: response => {\n          const options = Array.isArray(response) ? response : response?.data ? response.data : response ? [response] : [];\n          this.nsbOptions = options || [];\n          if (this.nsbOptions.length === 1) {\n            this.onNsbChange(this.nsbOptions[0].id);\n          }\n        },\n        error: () => {\n          this.error = 'Unable to load NSB list.';\n        }\n      });\n    }\n    onNsbChange(nsbId) {\n      const selected = this.nsbOptions.find(nsb => nsb.id === nsbId) || null;\n      this.selectedNsb = selected;\n      this.applicationForm.patchValue({\n        nsbId: nsbId || ''\n      });\n    }\n    goToStep(step) {\n      if (step < this.currentStep) {\n        this.currentStep = step;\n      } else {\n        if (!this.isStepValid(this.currentStep)) {\n          return;\n        }\n        this.currentStep = step;\n      }\n    }\n    nextStep() {\n      this.goToStep(this.currentStep + 1);\n    }\n    prevStep() {\n      this.goToStep(this.currentStep - 1);\n    }\n    saveDraft() {\n      if (!this.applicationForm.get('nsbId')?.value) {\n        this.error = 'NSB profile is required before saving a draft.';\n        return;\n      }\n      this.saving = true;\n      this.error = '';\n      const payload = this.buildPayload();\n      const operation = this.existingApplication ? this.licenseService.updateApplication(this.existingApplication.id, payload) : this.licenseService.createApplication(payload);\n      operation.pipe(finalize(() => {\n        this.saving = false;\n      })).subscribe({\n        next: application => {\n          this.existingApplication = application;\n        },\n        error: () => {\n          this.error = 'Failed to save draft.';\n        }\n      });\n    }\n    submitApplication() {\n      if (!this.isStepValid(3)) {\n        return;\n      }\n      if (!this.existingApplication) {\n        this.error = 'Please save the application as draft first.';\n        return;\n      }\n      this.submitting = true;\n      this.error = '';\n      this.licenseService.submitApplication(this.existingApplication.id).pipe(finalize(() => {\n        this.submitting = false;\n      })).subscribe({\n        next: () => {\n          this.router.navigate(['/portal/mark-licenses/dashboard']);\n        },\n        error: () => {\n          this.error = 'Failed to submit application.';\n        }\n      });\n    }\n    buildPayload() {\n      return {\n        nsbId: this.applicationForm.get('nsbId')?.value || '',\n        licenseTypes: this.getSelectedLicenseTypes(),\n        licenseDuration: LicenseDurationType.OTHER,\n        licenseDurationOther: '',\n        marksRequested: [],\n        annexBCompliance: this.applicationForm.get('agreementCompliance')?.value ?? false,\n        brandGuidelinesAck: this.applicationForm.get('markUsageCompliance')?.value ?? false,\n        modificationPolicyAcceptance: this.applicationForm.get('misleadingStatementsCompliance')?.value ?? false,\n        declarationSignatory: '',\n        signatoryTitle: '',\n        signatoryEmail: '',\n        auditRightsAcceptance: this.applicationForm.get('changesCompliance')?.value ?? false,\n        annualReportingCommitment: false,\n        dataSharingConsent: false\n      };\n    }\n    getSelectedLicenseTypes() {\n      const selected = [];\n      if (this.applicationForm.get('promotionalLicense')?.value) {\n        selected.push(MarkLicenseType.PROMOTIONAL_INSTITUTIONAL);\n      }\n      if (this.applicationForm.get('certificationBodyLicense')?.value) {\n        selected.push(MarkLicenseType.CERTIFICATION_BODY);\n      }\n      if (this.applicationForm.get('specialProjectLicense')?.value) {\n        selected.push(MarkLicenseType.SPECIAL_PROJECT);\n      }\n      return selected;\n    }\n    isStepValid(step) {\n      if (step === 1) {\n        const nsbId = this.applicationForm.get('nsbId')?.value;\n        if (!nsbId) {\n          this.error = 'Select an NSB to continue.';\n          return false;\n        }\n      }\n      if (step === 2) {\n        if (this.getSelectedLicenseTypes().length === 0) {\n          this.error = 'Select at least one license type to continue.';\n          return false;\n        }\n      }\n      if (step === 3) {\n        const requirementsMet = this.applicationForm.get('agreementCompliance')?.value && this.applicationForm.get('markUsageCompliance')?.value && this.applicationForm.get('misleadingStatementsCompliance')?.value && this.applicationForm.get('changesCompliance')?.value;\n        if (!requirementsMet) {\n          this.error = 'Please confirm all mark usage requirements.';\n          return false;\n        }\n      }\n      this.error = '';\n      return true;\n    }\n    static {\n      this.ɵfac = function MarkLicenseApplicationComponent_Factory(t) {\n        return new (t || MarkLicenseApplicationComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.NsbService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.MarkLicenseApplicationService), i0.ɵɵdirectiveInject(i5.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: MarkLicenseApplicationComponent,\n        selectors: [[\"app-mark-license-application\"]],\n        decls: 64,\n        vars: 32,\n        consts: [[1, \"flex\", \"flex-col\", \"h-full\", \"bg-gray-50\"], [1, \"bg-white\", \"shadow-sm\", \"border-b\", \"px-8\", \"py-4\"], [1, \"text-2xl\", \"font-bold\", \"text-gray-800\", \"mb-6\"], [1, \"flex\", \"items-center\", \"justify-between\", \"max-w-4xl\", \"mx-auto\"], [1, \"flex\", \"flex-col\", \"items-center\", \"relative\", \"z-10\", \"cursor-pointer\", 3, \"click\"], [1, \"w-10\", \"h-10\", \"rounded-full\", \"flex\", \"items-center\", \"justify-center\", \"font-bold\", \"transition-colors\", \"duration-300\", 3, \"ngClass\"], [1, \"text-sm\", \"mt-2\", \"font-medium\", 3, \"ngClass\"], [1, \"flex-1\", \"h-1\", \"mx-4\", \"bg-gray-200\", \"relative\", \"top-[-14px]\", \"-z-0\"], [1, \"h-full\", \"bg-blue-600\", \"transition-all\", \"duration-300\"], [1, \"flex\", \"flex-1\", \"overflow-hidden\"], [1, \"flex-1\", \"overflow-y-auto\", \"p-8\"], [1, \"max-w-4xl\", \"mx-auto\"], [\"class\", \"mb-6 rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700\", 4, \"ngIf\"], [\"class\", \"animate-fade-in\", 4, \"ngIf\"], [1, \"w-80\", \"bg-white\", \"border-l\", \"shadow-xl\", \"overflow-y-auto\", \"hidden\", \"lg:block\", \"sticky\", \"top-0\", \"h-full\"], [1, \"p-5\"], [1, \"text-sm\", \"font-bold\", \"text-gray-400\", \"uppercase\", \"tracking-wider\", \"mb-4\"], [1, \"space-y-4\"], [1, \"p-3\", \"bg-gray-50\", \"rounded\", \"border\", \"border-gray-100\", \"text-xs\"], [1, \"font-bold\", \"text-gray-700\", \"mb-1\"], [1, \"text-gray-600\", \"italic\"], [1, \"mt-6\", \"border-t\", \"pt-4\"], [1, \"text-xs\", \"text-gray-400\", \"text-center\"], [1, \"mb-6\", \"rounded-lg\", \"border\", \"border-red-200\", \"bg-red-50\", \"px-4\", \"py-3\", \"text-sm\", \"text-red-700\"], [1, \"animate-fade-in\"], [\"class\", \"rounded-lg border border-gray-200 bg-white p-6 text-sm text-gray-500\", 4, \"ngIf\"], [1, \"bg-white\", \"rounded-lg\", \"shadow-md\", \"p-6\", \"mb-6\"], [1, \"text-xl\", \"font-semibold\", \"text-gray-800\", \"border-b\", \"pb-3\", \"mb-4\"], [1, \"text-gray-600\", \"mb-6\"], [1, \"grid\", \"grid-cols-1\", \"md:grid-cols-2\", \"gap-6\"], [1, \"form-group\"], [1, \"text-sm\", \"font-medium\", \"text-gray-500\"], [1, \"text-lg\", \"text-gray-800\", \"font-medium\"], [1, \"form-group\", \"md:col-span-2\"], [4, \"ngIf\"], [1, \"flex\", \"justify-end\", \"gap-3\", \"mt-6\"], [1, \"px-6\", \"py-2\", \"border\", \"border-blue-600\", \"text-blue-600\", \"rounded-md\", \"hover:bg-blue-50\", \"transition\", 3, \"click\"], [1, \"px-6\", \"py-2\", \"bg-blue-600\", \"text-white\", \"rounded-md\", \"hover:bg-blue-700\", \"transition\", \"shadow-sm\", 3, \"click\"], [1, \"rounded-lg\", \"border\", \"border-gray-200\", \"bg-white\", \"p-6\", \"text-sm\", \"text-gray-500\"], [3, \"formGroup\"], [1, \"text-red-500\"], [1, \"space-y-6\"], [1, \"p-4\", \"border\", \"rounded-lg\", \"bg-gray-50\", \"hover:bg-white\", \"hover:shadow-sm\", \"transition-all\"], [1, \"flex\", \"items-start\", \"gap-3\", \"cursor-pointer\"], [\"type\", \"checkbox\", \"formControlName\", \"promotionalLicense\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [1, \"flex-1\"], [1, \"font-bold\", \"text-gray-800\", \"block\"], [1, \"text-sm\", \"text-gray-500\", \"mt-1\"], [1, \"mt-3\", \"text-xs\", \"text-gray-600\", \"italic\", \"bg-blue-50\", \"p-2\", \"rounded\", \"border-l-4\", \"border-blue-300\"], [\"type\", \"checkbox\", \"formControlName\", \"certificationBodyLicense\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [\"type\", \"checkbox\", \"formControlName\", \"specialProjectLicense\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [1, \"text-sm\", \"text-gray-500\", \"mb-4\"], [1, \"p-4\", \"border\", \"rounded-lg\", \"bg-gray-50\"], [\"type\", \"checkbox\", \"formControlName\", \"agreementCompliance\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [1, \"font-bold\", \"text-gray-800\"], [1, \"mt-2\", \"text-sm\", \"text-gray-600\", \"italic\", \"bg-gray-100\", \"p-3\", \"rounded-md\", \"border-l-4\", \"border-gray-400\"], [\"type\", \"checkbox\", \"formControlName\", \"markUsageCompliance\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [\"type\", \"checkbox\", \"formControlName\", \"misleadingStatementsCompliance\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [\"type\", \"checkbox\", \"formControlName\", \"changesCompliance\", 1, \"mt-1\", \"w-5\", \"h-5\", \"text-blue-600\", \"rounded\", \"focus:ring-blue-500\"], [1, \"flex\", \"justify-between\", \"mt-6\"], [1, \"px-6\", \"py-2\", \"border\", \"border-gray-300\", \"text-gray-700\", \"rounded-md\", \"hover:bg-gray-50\", \"transition\", 3, \"click\"], [1, \"flex\", \"gap-3\"], [1, \"bg-white\", \"rounded-lg\", \"shadow-md\", \"p-6\", \"mb-6\", \"text-center\"], [1, \"w-16\", \"h-16\", \"bg-green-100\", \"text-green-600\", \"rounded-full\", \"flex\", \"items-center\", \"justify-center\", \"mx-auto\", \"mb-4\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"fill\", \"none\", \"viewBox\", \"0 0 24 24\", \"stroke\", \"currentColor\", 1, \"h-8\", \"w-8\"], [\"stroke-linecap\", \"round\", \"stroke-linejoin\", \"round\", \"stroke-width\", \"2\", \"d\", \"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"], [1, \"text-2xl\", \"font-bold\", \"text-gray-800\", \"mb-2\"], [1, \"bg-blue-50\", \"p-4\", \"rounded-lg\", \"text-left\", \"mb-6\", \"border\", \"border-blue-100\"], [1, \"font-bold\", \"text-blue-800\", \"mb-2\"], [1, \"mb-1\"], [1, \"font-semibold\"], [1, \"px-8\", \"py-2\", \"bg-green-600\", \"text-white\", \"rounded-md\", \"hover:bg-green-700\", \"transition\", \"shadow-lg\", \"font-medium\", 3, \"click\"]],\n        template: function MarkLicenseApplicationComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2);\n            i0.ɵɵtext(3, \"ARSO Mark License Application\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"div\", 3)(5, \"div\", 4);\n            i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_Template_div_click_5_listener() {\n              return ctx.goToStep(1);\n            });\n            i0.ɵɵelementStart(6, \"div\", 5);\n            i0.ɵɵtext(7, \" 1 \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"span\", 6);\n            i0.ɵɵtext(9, \"NSB Profile\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(10, \"div\", 7);\n            i0.ɵɵelement(11, \"div\", 8);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"div\", 4);\n            i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_Template_div_click_12_listener() {\n              return ctx.goToStep(2);\n            });\n            i0.ɵɵelementStart(13, \"div\", 5);\n            i0.ɵɵtext(14, \" 2 \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"span\", 6);\n            i0.ɵɵtext(16, \"License Details\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(17, \"div\", 7);\n            i0.ɵɵelement(18, \"div\", 8);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(19, \"div\", 4);\n            i0.ɵɵlistener(\"click\", function MarkLicenseApplicationComponent_Template_div_click_19_listener() {\n              return ctx.goToStep(3);\n            });\n            i0.ɵɵelementStart(20, \"div\", 5);\n            i0.ɵɵtext(21, \" 3 \");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(22, \"span\", 6);\n            i0.ɵɵtext(23, \"Review & Submit\");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵelementStart(24, \"div\", 9)(25, \"div\", 10)(26, \"div\", 11);\n            i0.ɵɵtemplate(27, MarkLicenseApplicationComponent_div_27_Template, 2, 1, \"div\", 12);\n            i0.ɵɵtemplate(28, MarkLicenseApplicationComponent_div_28_Template, 39, 7, \"div\", 13);\n            i0.ɵɵtemplate(29, MarkLicenseApplicationComponent_div_29_Template, 84, 1, \"div\", 13);\n            i0.ɵɵtemplate(30, MarkLicenseApplicationComponent_div_30_Template, 32, 4, \"div\", 13);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(31, \"div\", 14)(32, \"div\", 15)(33, \"h3\", 16);\n            i0.ɵɵtext(34, \"ISO/IEC 17065:2012 Reference\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(35, \"div\", 17)(36, \"div\", 18)(37, \"div\", 19);\n            i0.ɵɵtext(38, \"4.1.2 Certification agreement\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(39, \"p\", 20);\n            i0.ɵɵtext(40, \"\\\"The certification body shall have a legally enforceable agreement for the provision of certification activities to its clients.\\\"\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(41, \"div\", 18)(42, \"div\", 19);\n            i0.ɵɵtext(43, \"4.2 Management of impartiality\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(44, \"p\", 20);\n            i0.ɵɵtext(45, \"\\\"Certification activities shall be undertaken impartially. The certification body shall be responsible for the impartiality of its certification activities...\\\"\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(46, \"div\", 18)(47, \"div\", 19);\n            i0.ɵɵtext(48, \"4.4 Non-discriminatory conditions\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(49, \"p\", 20);\n            i0.ɵɵtext(50, \"\\\"The policies and procedures under which the certification body operates, and the administration of them, shall be non-discriminatory.\\\"\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(51, \"div\", 18)(52, \"div\", 19);\n            i0.ɵɵtext(53, \"4.5 Confidentiality\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(54, \"p\", 20);\n            i0.ɵɵtext(55, \"\\\"The certification body shall be responsible, through legally enforceable commitments, for the management of all information obtained or created...\\\"\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(56, \"div\", 18)(57, \"div\", 19);\n            i0.ɵɵtext(58, \"5.1 Organizational structure\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(59, \"p\", 20);\n            i0.ɵɵtext(60, \"\\\"Certification activities shall be structured and managed so as to safeguard impartiality.\\\"\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(61, \"div\", 21)(62, \"p\", 22);\n            i0.ɵɵtext(63, \"ARSO Conformity Assessment Programme\");\n            i0.ɵɵelementEnd()()()()()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(6);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(14, _c0, ctx.currentStep >= 1, ctx.currentStep < 1));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(17, _c1, ctx.currentStep >= 1, ctx.currentStep < 1));\n            i0.ɵɵadvance(3);\n            i0.ɵɵstyleProp(\"width\", ctx.currentStep >= 2 ? \"100%\" : \"0%\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(20, _c0, ctx.currentStep >= 2, ctx.currentStep < 2));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(23, _c1, ctx.currentStep >= 2, ctx.currentStep < 2));\n            i0.ɵɵadvance(3);\n            i0.ɵɵstyleProp(\"width\", ctx.currentStep >= 3 ? \"100%\" : \"0%\");\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(26, _c0, ctx.currentStep >= 3, ctx.currentStep < 3));\n            i0.ɵɵadvance(2);\n            i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(29, _c1, ctx.currentStep >= 3, ctx.currentStep < 3));\n            i0.ɵɵadvance(5);\n            i0.ɵɵproperty(\"ngIf\", ctx.error);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.currentStep === 1);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.currentStep === 2);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.currentStep === 3);\n          }\n        },\n        dependencies: [i6.NgClass, i6.NgIf, i1.ɵNgNoValidate, i1.CheckboxControlValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName],\n        styles: [\".animate-fade-in[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_fadeIn .5s ease-in-out}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#cbd5e1;border-radius:3px}.overflow-y-auto[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#94a3b8}input[type=checkbox][_ngcontent-%COMP%]{accent-color:#2563eb;cursor:pointer}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}\"]\n      });\n    }\n  }\n  return MarkLicenseApplicationComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}