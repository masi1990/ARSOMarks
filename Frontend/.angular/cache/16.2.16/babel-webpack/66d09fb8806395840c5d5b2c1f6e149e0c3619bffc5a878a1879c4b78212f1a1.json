{"ast":null,"code":"import { finalize } from 'rxjs';\nimport { NsbRegistrationRequestStatus } from '../../shared/models/nsb-registration-request.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../modules/nsb-management/services/nsb-registration-request.service\";\nimport * as i2 from \"@angular/forms\";\nexport let NsbReviewComponent = /*#__PURE__*/(() => {\n  class NsbReviewComponent {\n    constructor(requestService, fb) {\n      this.requestService = requestService;\n      this.fb = fb;\n      this.requests = [];\n      this.selectedRequest = null;\n      this.loading = false;\n      this.error = '';\n      this.saving = false;\n      this.statusFilter = '';\n      this.searchTerm = '';\n      this.showReviewModal = false;\n      this.reviewAction = null;\n      this.filterForm = this.fb.group({\n        status: [''],\n        search: ['']\n      });\n      this.reviewForm = this.fb.group({\n        remarks: ['']\n      });\n    }\n    ngOnInit() {\n      this.loadRequests();\n      this.setupFilterWatchers();\n    }\n    setupFilterWatchers() {\n      this.filterForm.get('status')?.valueChanges.subscribe(status => {\n        this.statusFilter = status;\n        this.loadRequests();\n      });\n      this.filterForm.get('search')?.valueChanges.subscribe(search => {\n        this.searchTerm = search;\n        this.loadRequests();\n      });\n    }\n    loadRequests() {\n      this.loading = true;\n      this.error = '';\n      const params = {\n        skip: 0,\n        limit: 50\n      };\n      if (this.statusFilter) {\n        params.status = this.statusFilter;\n      }\n      if (this.searchTerm) {\n        params.search = this.searchTerm;\n      }\n      this.requestService.list(params).pipe(finalize(() => {\n        this.loading = false;\n      })).subscribe({\n        next: response => {\n          this.requests = response.data || [];\n        },\n        error: err => {\n          this.error = err.error?.message || 'Failed to load registration requests.';\n        }\n      });\n    }\n    viewRequest(request) {\n      this.selectedRequest = request;\n      this.loadRequestDetails(request.id);\n    }\n    loadRequestDetails(id) {\n      this.requestService.get(id).subscribe({\n        next: request => {\n          this.selectedRequest = request;\n        },\n        error: () => {\n          this.error = 'Failed to load request details.';\n        }\n      });\n    }\n    openReviewModal(request, action) {\n      this.selectedRequest = request;\n      this.reviewAction = action;\n      this.reviewForm.reset();\n      this.showReviewModal = true;\n    }\n    closeReviewModal() {\n      this.showReviewModal = false;\n      this.reviewAction = null;\n      this.selectedRequest = null;\n      this.reviewForm.reset();\n    }\n    submitReview() {\n      if (!this.selectedRequest || !this.reviewAction) {\n        return;\n      }\n      this.saving = true;\n      this.error = '';\n      const remarks = this.reviewForm.get('remarks')?.value || '';\n      if (this.reviewAction === 'reject' && !remarks.trim()) {\n        this.error = 'Remarks are required when rejecting a request.';\n        this.saving = false;\n        return;\n      }\n      const request$ = this.reviewAction === 'approve' ? this.requestService.approve(this.selectedRequest.id, remarks) : this.requestService.reject(this.selectedRequest.id, remarks);\n      request$.pipe(finalize(() => {\n        this.saving = false;\n      })).subscribe({\n        next: () => {\n          this.closeReviewModal();\n          this.loadRequests();\n        },\n        error: err => {\n          this.error = err.error?.message || `Failed to ${this.reviewAction} request. Please try again.`;\n        }\n      });\n    }\n    getStatusColor(status) {\n      switch (status) {\n        case 'DRAFT':\n          return 'bg-slate-100 text-slate-700';\n        case 'SUBMITTED':\n        case 'UNDER_REVIEW':\n          return 'bg-blue-100 text-blue-700';\n        case 'APPROVED':\n          return 'bg-emerald-100 text-emerald-700';\n        case 'REJECTED':\n          return 'bg-red-100 text-red-700';\n        default:\n          return 'bg-slate-100 text-slate-700';\n      }\n    }\n    getStatusLabel(status) {\n      switch (status) {\n        case 'DRAFT':\n          return 'Draft';\n        case 'SUBMITTED':\n          return 'Submitted';\n        case 'UNDER_REVIEW':\n          return 'Under Review';\n        case 'APPROVED':\n          return 'Approved';\n        case 'REJECTED':\n          return 'Rejected';\n        default:\n          return status;\n      }\n    }\n    canApprove(request) {\n      return request.status === NsbRegistrationRequestStatus.SUBMITTED || request.status === NsbRegistrationRequestStatus.UNDER_REVIEW;\n    }\n    canReject(request) {\n      return request.status === NsbRegistrationRequestStatus.SUBMITTED || request.status === NsbRegistrationRequestStatus.UNDER_REVIEW;\n    }\n    static {\n      this.ɵfac = function NsbReviewComponent_Factory(t) {\n        return new (t || NsbReviewComponent)(i0.ɵɵdirectiveInject(i1.NsbRegistrationRequestService), i0.ɵɵdirectiveInject(i2.FormBuilder));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: NsbReviewComponent,\n        selectors: [[\"app-nsb-review\"]],\n        decls: 0,\n        vars: 0,\n        template: function NsbReviewComponent_Template(rf, ctx) {},\n        styles: [\"(()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  {// webpackBootstrap \\\"use strict\\\";})()[_ngcontent-%COMP%] ;{%BLOCK%}\"]\n      });\n    }\n  }\n  return NsbReviewComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}