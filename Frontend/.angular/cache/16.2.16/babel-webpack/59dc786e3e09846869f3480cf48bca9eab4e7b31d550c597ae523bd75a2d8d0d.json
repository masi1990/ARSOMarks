{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { finalize } from 'rxjs';\nimport { RoleRequestStatus, UserRole } from '../../shared/models/user.model';\nexport let RoleAdminComponent = class RoleAdminComponent {\n  constructor(authService) {\n    this.authService = authService;\n    this.activeTab = 'requests';\n    // Requests Data\n    this.requests = [];\n    this.loadingRequests = false;\n    this.decidingId = null;\n    this.decisionError = '';\n    this.decisionSuccess = '';\n    this.decisionNotes = {};\n    // Users Data\n    this.users = [];\n    this.loadingUsers = false;\n    this.usersError = '';\n    // Role Assignment\n    this.assigningRolesUserId = null;\n    this.selectedRolesToAssign = [];\n    this.assignRolesNote = '';\n    this.assignRolesError = '';\n    this.assignRolesSuccess = '';\n    this.allRoleOptions = Object.values(UserRole).map(r => ({\n      value: r,\n      label: r.replace(/_/g, ' ')\n    }));\n  }\n  ngOnInit() {\n    this.loadRequests();\n    this.loadUsers();\n  }\n  setActiveTab(tab) {\n    this.activeTab = tab;\n  }\n  loadRequests() {\n    this.loadingRequests = true;\n    this.authService.listRoleRequests().pipe(finalize(() => {\n      this.loadingRequests = false;\n    })).subscribe({\n      next: reqs => {\n        this.requests = reqs || [];\n      },\n      error: err => {\n        this.requests = [];\n        this.decisionError = err?.error?.message || 'Failed to load requests.';\n      }\n    });\n  }\n  loadUsers() {\n    this.loadingUsers = true;\n    this.authService.getAllUsers().pipe(finalize(() => {\n      this.loadingUsers = false;\n    })).subscribe({\n      next: users => {\n        this.users = users || [];\n      },\n      error: err => {\n        this.users = [];\n        this.usersError = err?.error?.message || 'Failed to load users.';\n      }\n    });\n  }\n  decide(req, status) {\n    this.decisionError = '';\n    this.decisionSuccess = '';\n    this.decidingId = req.id;\n    const payload = {\n      status,\n      note: this.decisionNotes[req.id]?.trim() || undefined\n    };\n    this.authService.decideRoleRequest(req.id, payload).pipe(finalize(() => {\n      this.decidingId = null;\n    })).subscribe({\n      next: res => {\n        this.requests = this.requests.map(r => r.id === res.id ? res : r);\n        this.decisionSuccess = `Request ${status.toLowerCase()}.`;\n        // Refresh users list if approved to show updated roles\n        if (status === RoleRequestStatus.APPROVED) {\n          this.loadUsers();\n        }\n      },\n      error: err => {\n        this.decisionError = err?.error?.message || 'Action failed.';\n      }\n    });\n  }\n  formatRole(role) {\n    return (role || '').toString().replace(/_/g, ' ') || 'N/A';\n  }\n  formatRolesList(roles) {\n    return roles && roles.length ? roles.map(r => this.formatRole(r)).join(', ') : 'None';\n  }\n  statusBadgeClasses(status) {\n    switch (status) {\n      case RoleRequestStatus.APPROVED:\n        return 'bg-emerald-50 text-emerald-700';\n      case RoleRequestStatus.REJECTED:\n        return 'bg-rose-50 text-rose-700';\n      default:\n        return 'bg-amber-50 text-amber-700';\n    }\n  }\n  openAssignRolesModal(user) {\n    this.assigningRolesUserId = user.id;\n    this.selectedRolesToAssign = [];\n    this.assignRolesNote = '';\n    this.assignRolesError = '';\n    this.assignRolesSuccess = '';\n  }\n  closeAssignRolesModal() {\n    this.assigningRolesUserId = null;\n    this.selectedRolesToAssign = [];\n    this.assignRolesNote = '';\n    this.assignRolesError = '';\n    this.assignRolesSuccess = '';\n  }\n  toggleRoleSelection(role) {\n    if (this.selectedRolesToAssign.includes(role)) {\n      this.selectedRolesToAssign = this.selectedRolesToAssign.filter(r => r !== role);\n    } else {\n      this.selectedRolesToAssign = [...this.selectedRolesToAssign, role];\n    }\n  }\n  isRoleSelected(role) {\n    return this.selectedRolesToAssign.includes(role);\n  }\n  assignRoles() {\n    if (!this.assigningRolesUserId) {\n      return;\n    }\n    if (this.selectedRolesToAssign.length === 0) {\n      this.assignRolesError = 'Select at least one role to assign.';\n      return;\n    }\n    this.assignRolesError = '';\n    this.assignRolesSuccess = '';\n    const payload = {\n      roles: this.selectedRolesToAssign,\n      note: this.assignRolesNote?.trim() || undefined\n    };\n    this.authService.assignRolesToUser(this.assigningRolesUserId, payload).pipe(finalize(() => {})).subscribe({\n      next: updatedUser => {\n        this.assignRolesSuccess = 'Roles assigned successfully.';\n        // Update user in the list\n        this.users = this.users.map(u => u.id === updatedUser.id ? updatedUser : u);\n        // Close modal after a short delay\n        setTimeout(() => {\n          this.closeAssignRolesModal();\n          // Clear success message\n          setTimeout(() => {\n            this.assignRolesSuccess = '';\n          }, 3000);\n        }, 1000);\n      },\n      error: err => {\n        this.assignRolesError = err?.error?.message || 'Failed to assign roles.';\n      }\n    });\n  }\n  getUserCurrentRoles(user) {\n    return user.roles && user.roles.length > 0 ? user.roles : user.role ? [user.role] : [];\n  }\n};\nRoleAdminComponent = __decorate([Component({\n  selector: 'app-role-admin',\n  templateUrl: './role-admin.component.html',\n  styleUrls: ['./role-admin.component.scss']\n})], RoleAdminComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}