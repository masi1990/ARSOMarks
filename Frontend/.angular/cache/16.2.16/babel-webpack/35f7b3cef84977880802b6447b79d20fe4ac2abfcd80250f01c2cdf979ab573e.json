{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { UserRole } from '../../shared/models/user.model';\nexport let RoleReportsComponent = class RoleReportsComponent {\n  constructor(analytics, authService, route, router) {\n    this.analytics = analytics;\n    this.authService = authService;\n    this.route = route;\n    this.router = router;\n    this.UserRole = UserRole;\n    this.roleOptions = Object.values(UserRole);\n    this.selectedRole = UserRole.SUPER_ADMIN;\n    this.filters = {\n      region: '',\n      scheme: ''\n    };\n    this.loading = false;\n    this.error = '';\n  }\n  ngOnInit() {\n    this.sub = this.route.paramMap.subscribe(params => {\n      const roleParam = params.get('role');\n      const resolvedRole = this.resolveRole(roleParam);\n      if (resolvedRole !== this.selectedRole) {\n        this.selectedRole = resolvedRole;\n      }\n      this.loadReport();\n    });\n  }\n  ngOnDestroy() {\n    this.sub?.unsubscribe();\n  }\n  canView(role) {\n    const user = this.authService.currentUserValue;\n    const userRoles = user?.roles || (user?.role ? [user.role] : []);\n    return role === UserRole.SUPER_ADMIN || userRoles.includes(UserRole.SUPER_ADMIN) || userRoles.includes(role);\n  }\n  onRoleChange(role) {\n    if (!this.canView(role)) return;\n    this.router.navigate(['/portal/reports', role.toLowerCase()]);\n  }\n  applyFilters() {\n    this.loadReport();\n  }\n  exportCsv() {\n    if (!this.data) return;\n    const header = ['Label', 'Value', 'Status', 'Secondary'];\n    const rows = this.data.rows.map(r => [r.label, r.value, r.status || '', r.secondary || '']);\n    const csv = [header, ...rows].map(r => r.join(',')).join('\\n');\n    const blob = new Blob([csv], {\n      type: 'text/csv;charset=utf-8;'\n    });\n    const link = document.createElement('a');\n    link.href = URL.createObjectURL(blob);\n    link.download = `${this.selectedRole.toLowerCase()}-report.csv`;\n    link.click();\n    URL.revokeObjectURL(link.href);\n  }\n  loadReport() {\n    this.error = '';\n    this.loading = true;\n    this.analytics.getReport(this.selectedRole, this.filters).subscribe({\n      next: data => {\n        this.data = data;\n        this.loading = false;\n      },\n      error: err => {\n        this.error = err?.error?.message || 'Unable to load report data.';\n        this.loading = false;\n      }\n    });\n  }\n  resolveRole(roleParam) {\n    if (roleParam && this.canView(roleParam)) {\n      return roleParam;\n    }\n    const user = this.authService.currentUserValue;\n    const userRoles = user?.roles || (user?.role ? [user.role] : []);\n    if (userRoles.includes(UserRole.SUPER_ADMIN)) return UserRole.SUPER_ADMIN;\n    return userRoles[0] || UserRole.OPERATOR;\n  }\n};\nRoleReportsComponent = __decorate([Component({\n  selector: 'app-role-reports',\n  templateUrl: './role-reports.component.html',\n  styleUrls: ['./role-reports.component.scss']\n})], RoleReportsComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}