{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { DocumentCategory, OperatorDocumentType, DocumentVerificationStatus, TestReportStatus, PassFailStatus } from '../../shared/models/document-upload.model';\nexport let DocumentUploadComponent = class DocumentUploadComponent {\n  constructor(fb, documentUploadService, operatorService, productCertificationService, router, route) {\n    this.fb = fb;\n    this.documentUploadService = documentUploadService;\n    this.operatorService = operatorService;\n    this.productCertificationService = productCertificationService;\n    this.router = router;\n    this.route = route;\n    this.currentSection = 'A'; // A, B, C, D\n    this.loading = false;\n    this.error = '';\n    this.success = '';\n    this.operator = null;\n    this.application = null;\n    // Documents\n    this.operatorDocuments = [];\n    this.testReports = [];\n    this.existingCertificates = [];\n    this.supplyChainDocuments = [];\n    this.environmentalDocuments = [];\n    // File uploads\n    this.selectedFile = null;\n    this.uploading = false;\n    this.uploadProgress = 0;\n    // Options\n    this.documentCategories = Object.values(DocumentCategory).map(value => ({\n      value,\n      label: value.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())\n    }));\n    this.documentTypes = Object.values(OperatorDocumentType).map(value => ({\n      value,\n      label: value.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())\n    }));\n    this.passFailStatuses = Object.values(PassFailStatus).map(value => ({\n      value,\n      label: value.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())\n    }));\n    // Mandatory document types checklist\n    this.mandatoryDocumentTypes = [OperatorDocumentType.BUSINESS_REGISTRATION, OperatorDocumentType.TAX_CERTIFICATE, OperatorDocumentType.QUALITY_MANUAL, OperatorDocumentType.FACTORY_LAYOUT, OperatorDocumentType.PROCESS_FLOW_DIAGRAMS];\n    this.operatorDocumentForm = this.createOperatorDocumentForm();\n    this.testReportForm = this.createTestReportForm();\n    this.certificateForm = this.createCertificateForm();\n    this.supplyChainForm = this.createSupplyChainForm();\n    this.environmentalForm = this.createEnvironmentalForm();\n  }\n  ngOnInit() {\n    this.loadOperator();\n    this.route.params.subscribe(params => {\n      if (params['applicationId']) {\n        this.applicationId = params['applicationId'];\n        this.loadApplication();\n      }\n      if (params['productId']) {\n        this.productId = params['productId'];\n      }\n    });\n  }\n  createOperatorDocumentForm() {\n    return this.fb.group({\n      documentCategory: ['', Validators.required],\n      documentType: ['', Validators.required],\n      documentName: ['', [Validators.required, Validators.maxLength(255)]],\n      description: ['', Validators.maxLength(1000)],\n      expiryDate: [''],\n      file: [null, Validators.required]\n    });\n  }\n  createTestReportForm() {\n    return this.fb.group({\n      testLabName: ['', [Validators.required, Validators.maxLength(255)]],\n      labAccreditation: ['', [Validators.required, Validators.maxLength(255)]],\n      testStandard: ['', [Validators.required, Validators.maxLength(100)]],\n      testDate: ['', Validators.required],\n      sampleDescription: ['', [Validators.required, Validators.maxLength(1000)]],\n      testParameters: ['', [Validators.required, Validators.maxLength(2000)]],\n      testResultsSummary: ['', [Validators.required, Validators.maxLength(2000)]],\n      passFail: ['', Validators.required],\n      file: [null, Validators.required]\n    });\n  }\n  createCertificateForm() {\n    return this.fb.group({\n      certificateName: ['', [Validators.required, Validators.maxLength(255)]],\n      certificateNumber: ['', [Validators.required, Validators.maxLength(50)]],\n      issuingBody: ['', [Validators.required, Validators.maxLength(255)]],\n      issueDate: ['', Validators.required],\n      expiryDate: ['', Validators.required],\n      certificateScope: ['', [Validators.required, Validators.maxLength(1000)]],\n      file: [null, Validators.required]\n    });\n  }\n  createSupplyChainForm() {\n    return this.fb.group({\n      documentType: ['', Validators.required],\n      documentName: ['', [Validators.required, Validators.maxLength(255)]],\n      description: ['', Validators.maxLength(1000)],\n      file: [null, Validators.required]\n    });\n  }\n  createEnvironmentalForm() {\n    return this.fb.group({\n      documentType: ['', Validators.required],\n      documentName: ['', [Validators.required, Validators.maxLength(255)]],\n      description: ['', Validators.maxLength(1000)],\n      file: [null, Validators.required]\n    });\n  }\n  loadOperator() {\n    this.operatorService.getMyOperator().subscribe({\n      next: operator => {\n        this.operator = operator;\n        if (operator) {\n          this.loadOperatorDocuments(operator.id);\n        }\n      },\n      error: error => {\n        console.error('Error loading operator:', error);\n      }\n    });\n  }\n  loadApplication() {\n    if (this.applicationId) {\n      this.productCertificationService.getApplicationById(this.applicationId).subscribe({\n        next: application => {\n          this.application = application;\n          if (application.products && application.products.length > 0) {\n            this.productId = application.products[0].id;\n          }\n          this.loadTestReports();\n          this.loadCertificates();\n          this.loadEnvironmentalDocuments();\n        },\n        error: error => {\n          console.error('Error loading application:', error);\n        }\n      });\n    }\n  }\n  loadOperatorDocuments(operatorId) {\n    this.loading = true;\n    this.documentUploadService.getOperatorDocuments(operatorId).subscribe({\n      next: documents => {\n        this.operatorDocuments = documents;\n        this.loading = false;\n      },\n      error: error => {\n        this.loading = false;\n        console.error('Error loading operator documents:', error);\n      }\n    });\n  }\n  loadTestReports() {\n    const params = {};\n    if (this.productId) params.productId = this.productId;\n    if (this.applicationId) params.applicationId = this.applicationId;\n    this.documentUploadService.getTestReports(params).subscribe({\n      next: reports => {\n        this.testReports = reports;\n      },\n      error: error => {\n        console.error('Error loading test reports:', error);\n      }\n    });\n  }\n  loadCertificates() {\n    const params = {};\n    if (this.productId) params.productId = this.productId;\n    if (this.applicationId) params.applicationId = this.applicationId;\n    this.documentUploadService.getExistingCertificates(params).subscribe({\n      next: certificates => {\n        this.existingCertificates = certificates;\n      },\n      error: error => {\n        console.error('Error loading certificates:', error);\n      }\n    });\n  }\n  loadSupplyChainDocuments() {\n    const params = {};\n    if (this.operator?.id) params.operatorId = this.operator.id;\n    if (this.productId) params.productId = this.productId;\n    this.documentUploadService.getSupplyChainDocuments(params).subscribe({\n      next: documents => {\n        this.supplyChainDocuments = documents;\n      },\n      error: error => {\n        console.error('Error loading supply chain documents:', error);\n      }\n    });\n  }\n  loadEnvironmentalDocuments() {\n    const params = {};\n    if (this.productId) params.productId = this.productId;\n    if (this.applicationId) params.applicationId = this.applicationId;\n    this.documentUploadService.getEnvironmentalDocuments(params).subscribe({\n      next: documents => {\n        this.environmentalDocuments = documents;\n      },\n      error: error => {\n        console.error('Error loading environmental documents:', error);\n      }\n    });\n  }\n  onFileSelected(event, form) {\n    const file = event.target.files[0];\n    if (file) {\n      // Validate file size (max 10MB)\n      if (file.size > 10 * 1024 * 1024) {\n        this.error = 'File size must be less than 10MB';\n        return;\n      }\n      // Validate file type\n      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/png', 'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];\n      if (!allowedTypes.includes(file.type)) {\n        this.error = 'Invalid file type. Allowed types: PDF, JPG, PNG, DOC, DOCX';\n        return;\n      }\n      form.patchValue({\n        file\n      });\n      this.selectedFile = file;\n      this.error = '';\n    }\n  }\n  uploadOperatorDocument() {\n    if (this.operatorDocumentForm.invalid || !this.operator) {\n      this.markFormGroupTouched(this.operatorDocumentForm);\n      return;\n    }\n    this.uploading = true;\n    this.error = '';\n    this.success = '';\n    const formValue = this.operatorDocumentForm.value;\n    const request = {\n      documentCategory: formValue.documentCategory,\n      documentType: formValue.documentType,\n      documentName: formValue.documentName,\n      description: formValue.description,\n      expiryDate: formValue.expiryDate,\n      file: formValue.file,\n      operatorId: this.operator.id\n    };\n    this.documentUploadService.uploadOperatorDocument(this.operator.id, request).subscribe({\n      next: () => {\n        this.uploading = false;\n        this.success = 'Document uploaded successfully';\n        this.operatorDocumentForm.reset();\n        this.selectedFile = null;\n        this.loadOperatorDocuments(this.operator.id);\n        setTimeout(() => {\n          this.success = '';\n        }, 3000);\n      },\n      error: error => {\n        this.uploading = false;\n        this.error = error.error?.message || 'Failed to upload document';\n      }\n    });\n  }\n  uploadTestReport() {\n    if (this.testReportForm.invalid) {\n      this.markFormGroupTouched(this.testReportForm);\n      return;\n    }\n    this.uploading = true;\n    this.error = '';\n    this.success = '';\n    const formValue = this.testReportForm.value;\n    const request = {\n      testLabName: formValue.testLabName,\n      labAccreditation: formValue.labAccreditation,\n      testStandard: formValue.testStandard,\n      testDate: formValue.testDate,\n      sampleDescription: formValue.sampleDescription,\n      testParameters: formValue.testParameters,\n      testResultsSummary: formValue.testResultsSummary,\n      passFail: formValue.passFail,\n      file: formValue.file,\n      productId: this.productId,\n      applicationId: this.applicationId\n    };\n    this.documentUploadService.uploadTestReport(request).subscribe({\n      next: () => {\n        this.uploading = false;\n        this.success = 'Test report uploaded successfully';\n        this.testReportForm.reset();\n        this.selectedFile = null;\n        this.loadTestReports();\n        setTimeout(() => {\n          this.success = '';\n        }, 3000);\n      },\n      error: error => {\n        this.uploading = false;\n        this.error = error.error?.message || 'Failed to upload test report';\n      }\n    });\n  }\n  uploadCertificate() {\n    if (this.certificateForm.invalid) {\n      this.markFormGroupTouched(this.certificateForm);\n      return;\n    }\n    this.uploading = true;\n    this.error = '';\n    this.success = '';\n    const formValue = this.certificateForm.value;\n    const request = {\n      certificateName: formValue.certificateName,\n      certificateNumber: formValue.certificateNumber,\n      issuingBody: formValue.issuingBody,\n      issueDate: formValue.issueDate,\n      expiryDate: formValue.expiryDate,\n      certificateScope: formValue.certificateScope,\n      file: formValue.file,\n      productId: this.productId,\n      applicationId: this.applicationId\n    };\n    this.documentUploadService.uploadCertificate(request).subscribe({\n      next: () => {\n        this.uploading = false;\n        this.success = 'Certificate uploaded successfully';\n        this.certificateForm.reset();\n        this.selectedFile = null;\n        this.loadCertificates();\n        setTimeout(() => {\n          this.success = '';\n        }, 3000);\n      },\n      error: error => {\n        this.uploading = false;\n        this.error = error.error?.message || 'Failed to upload certificate';\n      }\n    });\n  }\n  uploadSupplyChainDocument() {\n    if (this.supplyChainForm.invalid || !this.operator) {\n      this.markFormGroupTouched(this.supplyChainForm);\n      return;\n    }\n    this.uploading = true;\n    this.error = '';\n    this.success = '';\n    const formValue = this.supplyChainForm.value;\n    const request = {\n      documentCategory: DocumentCategory.SUPPLY_CHAIN,\n      documentType: formValue.documentType,\n      documentName: formValue.documentName,\n      description: formValue.description,\n      file: formValue.file,\n      operatorId: this.operator.id,\n      productId: this.productId\n    };\n    this.documentUploadService.uploadSupplyChainDocument(request).subscribe({\n      next: () => {\n        this.uploading = false;\n        this.success = 'Supply chain document uploaded successfully';\n        this.supplyChainForm.reset();\n        this.selectedFile = null;\n        this.loadSupplyChainDocuments();\n        setTimeout(() => {\n          this.success = '';\n        }, 3000);\n      },\n      error: error => {\n        this.uploading = false;\n        this.error = error.error?.message || 'Failed to upload document';\n      }\n    });\n  }\n  uploadEnvironmentalDocument() {\n    if (this.environmentalForm.invalid) {\n      this.markFormGroupTouched(this.environmentalForm);\n      return;\n    }\n    this.uploading = true;\n    this.error = '';\n    this.success = '';\n    const formValue = this.environmentalForm.value;\n    const request = {\n      documentCategory: DocumentCategory.ENVIRONMENTAL,\n      documentType: formValue.documentType,\n      documentName: formValue.documentName,\n      description: formValue.description,\n      file: formValue.file,\n      productId: this.productId,\n      applicationId: this.applicationId\n    };\n    this.documentUploadService.uploadEnvironmentalDocument(request).subscribe({\n      next: () => {\n        this.uploading = false;\n        this.success = 'Environmental document uploaded successfully';\n        this.environmentalForm.reset();\n        this.selectedFile = null;\n        this.loadEnvironmentalDocuments();\n        setTimeout(() => {\n          this.success = '';\n        }, 3000);\n      },\n      error: error => {\n        this.uploading = false;\n        this.error = error.error?.message || 'Failed to upload document';\n      }\n    });\n  }\n  deleteDocument(documentId, section) {\n    if (!confirm('Are you sure you want to delete this document?')) {\n      return;\n    }\n    let deleteObservable;\n    switch (section) {\n      case 'operator':\n        if (this.operator) {\n          deleteObservable = this.documentUploadService.deleteOperatorDocument(this.operator.id, documentId);\n        }\n        break;\n      case 'test-report':\n        deleteObservable = this.documentUploadService.deleteTestReport(documentId);\n        break;\n      case 'certificate':\n        deleteObservable = this.documentUploadService.deleteCertificate(documentId);\n        break;\n      case 'supply-chain':\n        deleteObservable = this.documentUploadService.deleteSupplyChainDocument(documentId);\n        break;\n      case 'environmental':\n        deleteObservable = this.documentUploadService.deleteEnvironmentalDocument(documentId);\n        break;\n    }\n    if (deleteObservable) {\n      deleteObservable.subscribe({\n        next: () => {\n          this.success = 'Document deleted successfully';\n          // Reload documents\n          if (this.operator) this.loadOperatorDocuments(this.operator.id);\n          this.loadTestReports();\n          this.loadCertificates();\n          this.loadSupplyChainDocuments();\n          this.loadEnvironmentalDocuments();\n          setTimeout(() => {\n            this.success = '';\n          }, 3000);\n        },\n        error: error => {\n          this.error = error.error?.message || 'Failed to delete document';\n        }\n      });\n    }\n  }\n  downloadDocument(documentId, fileName) {\n    if (this.operator) {\n      this.documentUploadService.downloadOperatorDocument(this.operator.id, documentId).subscribe({\n        next: blob => {\n          const url = window.URL.createObjectURL(blob);\n          const link = document.createElement('a');\n          link.href = url;\n          link.download = fileName;\n          link.click();\n          window.URL.revokeObjectURL(url);\n        },\n        error: error => {\n          this.error = 'Failed to download document';\n        }\n      });\n    }\n  }\n  getStatusColor(status) {\n    switch (status) {\n      case DocumentVerificationStatus.APPROVED:\n      case TestReportStatus.VERIFIED:\n        return 'text-green-600 bg-green-100';\n      case DocumentVerificationStatus.REJECTED:\n      case TestReportStatus.REJECTED:\n        return 'text-red-600 bg-red-100';\n      case DocumentVerificationStatus.EXPIRED:\n      case TestReportStatus.EXPIRED:\n        return 'text-orange-600 bg-orange-100';\n      case DocumentVerificationStatus.UNDER_REVIEW:\n        return 'text-blue-600 bg-blue-100';\n      default:\n        return 'text-gray-600 bg-gray-100';\n    }\n  }\n  isMandatoryDocumentUploaded(documentType) {\n    return this.operatorDocuments.some(doc => doc.documentType === documentType && doc.isCurrentVersion && doc.verificationStatus === DocumentVerificationStatus.APPROVED);\n  }\n  markFormGroupTouched(formGroup) {\n    Object.keys(formGroup.controls).forEach(key => {\n      const control = formGroup.get(key);\n      control?.markAsTouched();\n    });\n  }\n  formatFileSize(bytes) {\n    if (bytes === 0) return '0 Bytes';\n    const k = 1024;\n    const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\n    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];\n  }\n  hasEmaApplication() {\n    if (!this.application?.markRequested) return false;\n    return this.application.markRequested.includes(MarkRequestedType.ECO_MARK_AFRICA) || this.application.markRequested.includes(MarkRequestedType.BOTH);\n  }\n  switchSection(section) {\n    this.currentSection = section;\n    if (section === 'C') {\n      this.loadSupplyChainDocuments();\n    }\n  }\n};\nDocumentUploadComponent = __decorate([Component({\n  selector: 'app-document-upload',\n  templateUrl: './document-upload.component.html',\n  styleUrls: ['./document-upload.component.scss']\n})], DocumentUploadComponent);","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}