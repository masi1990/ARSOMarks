{"ast":null,"code":"import { RoleRequestStatus, RoleRequestType, UserRole } from '../../../shared/models/user.model';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../modules/auth/services/auth.service\";\nimport * as i2 from \"../../../modules/auth/services/role-request.service\";\nimport * as i3 from \"@angular/common\";\nfunction ManageRolesComponent_div_11_button_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function ManageRolesComponent_div_11_button_3_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const role_r8 = i0.ɵɵnextContext().$implicit;\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.requestRemove(role_r8));\n    });\n    i0.ɵɵtext(1, \" Relinquish \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r9 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r9.submitting);\n  }\n}\nfunction ManageRolesComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20)(1, \"span\", 21);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, ManageRolesComponent_div_11_button_3_Template, 2, 1, \"button\", 22);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const role_r8 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(role_r8);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", role_r8 !== ctx_r0.UserRole.PUBLIC);\n  }\n}\nfunction ManageRolesComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtext(1, \"No roles assigned.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ManageRolesComponent_label_19_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"label\", 25)(1, \"div\", 26)(2, \"input\", 27);\n    i0.ɵɵlistener(\"change\", function ManageRolesComponent_label_19_Template_input_change_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r15);\n      const role_r13 = restoredCtx.$implicit;\n      const ctx_r14 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r14.toggleAssign(role_r13));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"span\", 21);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const role_r13 = ctx.$implicit;\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"checked\", ctx_r2.selectedAssign.has(role_r13));\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(role_r13);\n  }\n}\nfunction ManageRolesComponent_div_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r3 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r3.error);\n  }\n}\nfunction ManageRolesComponent_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 29);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r4.success);\n  }\n}\nfunction ManageRolesComponent_span_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 30);\n    i0.ɵɵtext(1, \"Loading\\u2026\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction ManageRolesComponent_div_33_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 24);\n    i0.ɵɵtext(1, \"No requests yet.\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function (a0, a1, a2) {\n  return {\n    \"bg-amber-50 text-amber-700\": a0,\n    \"bg-emerald-50 text-emerald-700\": a1,\n    \"bg-rose-50 text-rose-700\": a2\n  };\n};\nfunction ManageRolesComponent_div_34_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33)(1, \"div\")(2, \"p\", 34);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\", 10);\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"span\", 35);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const r_r17 = ctx.$implicit;\n    const ctx_r16 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate2(\" \", r_r17.requestType || \"ASSIGN\", \": \", r_r17.requestedRoles.join(\", \"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(6, 5, r_r17.createdAt, \"short\"), \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction3(8, _c0, r_r17.status === ctx_r16.RoleRequestStatus.PENDING, r_r17.status === ctx_r16.RoleRequestStatus.APPROVED, r_r17.status === ctx_r16.RoleRequestStatus.REJECTED));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", r_r17.status, \" \");\n  }\n}\nfunction ManageRolesComponent_div_34_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 31);\n    i0.ɵɵtemplate(1, ManageRolesComponent_div_34_div_1_Template, 9, 12, \"div\", 32);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r7 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r7.requests);\n  }\n}\nexport let ManageRolesComponent = /*#__PURE__*/(() => {\n  class ManageRolesComponent {\n    constructor(authService, roleRequestService) {\n      this.authService = authService;\n      this.roleRequestService = roleRequestService;\n      this.UserRole = UserRole;\n      this.RoleRequestStatus = RoleRequestStatus;\n      this.RoleRequestType = RoleRequestType;\n      this.user = null;\n      this.currentRoles = [];\n      this.selectableRoles = [UserRole.CB_ADMIN, UserRole.CB_USER, UserRole.NSB_ADMIN, UserRole.NSB_USER, UserRole.ACCREDITATION_BODY];\n      this.selectedAssign = new Set();\n      this.requests = [];\n      this.loading = false;\n      this.submitting = false;\n      this.error = '';\n      this.success = '';\n    }\n    ngOnInit() {\n      this.user = this.authService.currentUserValue;\n      this.currentRoles = this.user?.roles || (this.user?.role ? [this.user.role] : []);\n      this.loadRequests();\n    }\n    toggleAssign(role) {\n      if (this.selectedAssign.has(role)) {\n        this.selectedAssign.delete(role);\n      } else {\n        this.selectedAssign.add(role);\n      }\n    }\n    requestAssign() {\n      this.error = '';\n      this.success = '';\n      if (!this.selectedAssign.size) {\n        this.error = 'Select at least one role to request.';\n        return;\n      }\n      this.submitting = true;\n      this.roleRequestService.createRequest(Array.from(this.selectedAssign), undefined, RoleRequestType.ASSIGN).subscribe({\n        next: res => {\n          this.success = 'Request submitted.';\n          this.requests = [...(Array.isArray(res) ? res : [res]), ...this.requests];\n          this.selectedAssign.clear();\n        },\n        error: err => {\n          this.error = err?.error?.message || 'Failed to submit request.';\n        },\n        complete: () => {\n          this.submitting = false;\n        }\n      });\n    }\n    requestRemove(role) {\n      this.error = '';\n      this.success = '';\n      this.submitting = true;\n      this.roleRequestService.createRequest([role], undefined, RoleRequestType.REMOVE).subscribe({\n        next: res => {\n          this.success = 'Removal request submitted.';\n          this.requests = [...(Array.isArray(res) ? res : [res]), ...this.requests];\n        },\n        error: err => {\n          this.error = err?.error?.message || 'Failed to submit removal request.';\n        },\n        complete: () => {\n          this.submitting = false;\n        }\n      });\n    }\n    loadRequests() {\n      this.loading = true;\n      this.authService.getMyRoleRequests().subscribe({\n        next: reqs => {\n          this.requests = reqs || [];\n          this.loading = false;\n        },\n        error: () => {\n          this.requests = [];\n          this.loading = false;\n        }\n      });\n    }\n    hasRole(role) {\n      return this.currentRoles.includes(role);\n    }\n    static {\n      this.ɵfac = function ManageRolesComponent_Factory(t) {\n        return new (t || ManageRolesComponent)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i2.RoleRequestService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: ManageRolesComponent,\n        selectors: [[\"app-manage-roles\"]],\n        decls: 35,\n        vars: 9,\n        consts: [[1, \"space-y-6\"], [1, \"rounded-2xl\", \"bg-white\", \"border\", \"border-slate-200\", \"p-6\", \"shadow-sm\"], [1, \"text-xl\", \"font-bold\", \"text-slate-900\"], [1, \"text-sm\", \"text-slate-600\", \"mt-1\"], [1, \"mt-4\", \"grid\", \"gap-4\", \"md:grid-cols-2\"], [1, \"rounded-xl\", \"border\", \"border-slate-200\", \"p-4\"], [1, \"text-lg\", \"font-semibold\", \"text-slate-900\"], [1, \"mt-3\", \"space-y-2\"], [\"class\", \"flex items-center justify-between rounded-lg border border-slate-100 px-3 py-2\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-sm text-slate-500\", 4, \"ngIf\"], [1, \"text-xs\", \"text-slate-600\"], [\"class\", \"flex items-center justify-between rounded-lg border border-slate-100 px-3 py-2 cursor-pointer\", 4, \"ngFor\", \"ngForOf\"], [1, \"btn-primary\", \"mt-3\", 3, \"disabled\", \"click\"], [1, \"mt-4\", \"flex\", \"flex-wrap\", \"gap-2\"], [\"class\", \"alert alert-rose\", 4, \"ngIf\"], [\"class\", \"alert alert-emerald\", 4, \"ngIf\"], [1, \"flex\", \"items-center\", \"justify-between\", \"mb-3\"], [1, \"text-lg\", \"font-bold\", \"text-slate-900\"], [\"class\", \"text-xs text-slate-500\", 4, \"ngIf\"], [\"class\", \"divide-y divide-slate-200\", 4, \"ngIf\"], [1, \"flex\", \"items-center\", \"justify-between\", \"rounded-lg\", \"border\", \"border-slate-100\", \"px-3\", \"py-2\"], [1, \"text-sm\", \"font-semibold\", \"text-slate-800\"], [\"class\", \"text-sm font-semibold text-rose-600 hover:text-rose-700\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [1, \"text-sm\", \"font-semibold\", \"text-rose-600\", \"hover:text-rose-700\", 3, \"disabled\", \"click\"], [1, \"text-sm\", \"text-slate-500\"], [1, \"flex\", \"items-center\", \"justify-between\", \"rounded-lg\", \"border\", \"border-slate-100\", \"px-3\", \"py-2\", \"cursor-pointer\"], [1, \"flex\", \"items-center\", \"gap-2\"], [\"type\", \"checkbox\", 3, \"checked\", \"change\"], [1, \"alert\", \"alert-rose\"], [1, \"alert\", \"alert-emerald\"], [1, \"text-xs\", \"text-slate-500\"], [1, \"divide-y\", \"divide-slate-200\"], [\"class\", \"py-3 flex items-center justify-between\", 4, \"ngFor\", \"ngForOf\"], [1, \"py-3\", \"flex\", \"items-center\", \"justify-between\"], [1, \"text-sm\", \"font-semibold\", \"text-slate-900\"], [1, \"text-xs\", \"font-semibold\", \"px-3\", \"py-1\", \"rounded-full\", 3, \"ngClass\"]],\n        template: function ManageRolesComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"section\", 1)(2, \"h2\", 2);\n            i0.ɵɵtext(3, \"Manage Roles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"p\", 3);\n            i0.ɵɵtext(5, \"Request new roles or relinquish ones you no longer need.\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"div\", 4)(7, \"div\", 5)(8, \"h3\", 6);\n            i0.ɵɵtext(9, \"My Current Roles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(10, \"div\", 7);\n            i0.ɵɵtemplate(11, ManageRolesComponent_div_11_Template, 4, 2, \"div\", 8);\n            i0.ɵɵtemplate(12, ManageRolesComponent_div_12_Template, 2, 0, \"div\", 9);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(13, \"div\", 5)(14, \"h3\", 6);\n            i0.ɵɵtext(15, \"Request Additional Roles\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(16, \"p\", 10);\n            i0.ɵɵtext(17, \"Select one or more roles to request.\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(18, \"div\", 7);\n            i0.ɵɵtemplate(19, ManageRolesComponent_label_19_Template, 5, 2, \"label\", 11);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(20, \"button\", 12);\n            i0.ɵɵlistener(\"click\", function ManageRolesComponent_Template_button_click_20_listener() {\n              return ctx.requestAssign();\n            });\n            i0.ɵɵtext(21, \"Request Access\");\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelementStart(22, \"div\", 13);\n            i0.ɵɵtemplate(23, ManageRolesComponent_div_23_Template, 2, 1, \"div\", 14);\n            i0.ɵɵtemplate(24, ManageRolesComponent_div_24_Template, 2, 1, \"div\", 15);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(25, \"section\", 1)(26, \"div\", 16)(27, \"div\")(28, \"h3\", 17);\n            i0.ɵɵtext(29, \"Request History\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(30, \"p\", 10);\n            i0.ɵɵtext(31, \"Add / remove role requests\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(32, ManageRolesComponent_span_32_Template, 2, 0, \"span\", 18);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(33, ManageRolesComponent_div_33_Template, 2, 0, \"div\", 9);\n            i0.ɵɵtemplate(34, ManageRolesComponent_div_34_Template, 2, 1, \"div\", 19);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(11);\n            i0.ɵɵproperty(\"ngForOf\", ctx.currentRoles);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.currentRoles.length === 0);\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"ngForOf\", ctx.selectableRoles);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"disabled\", ctx.submitting);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngIf\", ctx.error);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.success);\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.requests.length);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.requests.length);\n          }\n        },\n        dependencies: [i3.NgClass, i3.NgForOf, i3.NgIf, i3.DatePipe],\n        styles: [\".btn-primary[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;border-radius:.5rem;--tw-bg-opacity: 1;background-color:rgb(37 99 235 / var(--tw-bg-opacity, 1));padding:.5rem 1rem;font-size:.875rem;line-height:1.25rem;font-weight:600;--tw-text-opacity: 1;color:rgb(255 255 255 / var(--tw-text-opacity, 1));--tw-shadow: 0 1px 2px 0 rgb(0 0 0 / .05);--tw-shadow-colored: 0 1px 2px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000),var(--tw-ring-shadow, 0 0 #0000),var(--tw-shadow)}.btn-primary[_ngcontent-%COMP%]:hover{--tw-bg-opacity: 1;background-color:rgb(29 78 216 / var(--tw-bg-opacity, 1))}.btn-primary[_ngcontent-%COMP%]:disabled{opacity:.6}.alert[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:.5rem;border-radius:.5rem;border-width:1px;padding:.5rem .75rem;font-size:.875rem;line-height:1.25rem}.alert-rose[_ngcontent-%COMP%]{--tw-border-opacity: 1;border-color:rgb(254 205 211 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(255 241 242 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(190 18 60 / var(--tw-text-opacity, 1))}.alert-emerald[_ngcontent-%COMP%]{--tw-border-opacity: 1;border-color:rgb(167 243 208 / var(--tw-border-opacity, 1));--tw-bg-opacity: 1;background-color:rgb(236 253 245 / var(--tw-bg-opacity, 1));--tw-text-opacity: 1;color:rgb(4 120 87 / var(--tw-text-opacity, 1))}\"]\n      });\n    }\n  }\n  return ManageRolesComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}