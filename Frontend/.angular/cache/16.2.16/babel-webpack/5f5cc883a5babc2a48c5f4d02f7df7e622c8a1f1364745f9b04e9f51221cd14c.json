{"ast":null,"code":"import { FormControl } from '@angular/forms';\nimport { debounceTime, distinctUntilChanged, Subject, takeUntil } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./traceability-public.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"@angular/forms\";\nfunction TraceabilityListComponent_option_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r6 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", c_r6);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(c_r6);\n  }\n}\nfunction TraceabilityListComponent_option_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const c_r7 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", c_r7);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(c_r7);\n  }\n}\nfunction TraceabilityListComponent_option_32_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 18);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r8 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", s_r8);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(s_r8);\n  }\n}\nfunction TraceabilityListComponent_div_39_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 19);\n    i0.ɵɵtext(1, \"Loading...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TraceabilityListComponent_div_40_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r4 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(ctx_r4.error);\n  }\n}\nfunction TraceabilityListComponent_div_41_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 27);\n    i0.ɵɵtext(1, \"No products found with current filters.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction TraceabilityListComponent_div_41_div_7_div_1_span_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 41);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const s_r15 = ctx.$implicit;\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", s_r15, \" \");\n  }\n}\nfunction TraceabilityListComponent_div_41_div_7_div_1_span_15_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 42);\n    i0.ɵɵtext(1, \"(Expired)\");\n    i0.ɵɵelementEnd();\n  }\n}\nconst _c0 = function (a1) {\n  return [\"/traceability/product\", a1];\n};\nconst _c1 = function () {\n  return [\"/traceability/verify\"];\n};\nconst _c2 = function (a0) {\n  return {\n    token: a0\n  };\n};\nfunction TraceabilityListComponent_div_41_div_7_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 30)(1, \"div\", 31)(2, \"div\", 32)(3, \"span\", 33);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"span\", 24);\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 23);\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 34);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 35);\n    i0.ɵɵtemplate(12, TraceabilityListComponent_div_41_div_7_div_1_span_12_Template, 2, 1, \"span\", 36);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(13, \"div\", 24);\n    i0.ɵɵtext(14);\n    i0.ɵɵtemplate(15, TraceabilityListComponent_div_41_div_7_div_1_span_15_Template, 2, 0, \"span\", 37);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 38)(17, \"a\", 39);\n    i0.ɵɵtext(18, \"Details\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"a\", 40);\n    i0.ɵɵtext(20, \" Open verification \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const p_r12 = ctx.$implicit;\n    const ctx_r11 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(p_r12.cocNumber);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(p_r12.originCountryName || p_r12.countryOfOrigin || \"Origin N/A\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(p_r12.productName || \"Product\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" \", p_r12.brand, \" \\u2022 \", p_r12.category || \"Category N/A\", \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", p_r12.standards);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\" Issued \", ctx_r11.formatDate(p_r12.issueDate), \" \\u2022 Expires \", ctx_r11.formatDate(p_r12.expiryDate), \" \");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r11.isExpired(p_r12.expiryDate));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction1(12, _c0, p_r12.id));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"routerLink\", i0.ɵɵpureFunction0(14, _c1))(\"queryParams\", i0.ɵɵpureFunction1(15, _c2, p_r12.qrUrl));\n  }\n}\nfunction TraceabilityListComponent_div_41_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 28);\n    i0.ɵɵtemplate(1, TraceabilityListComponent_div_41_div_7_div_1_Template, 21, 17, \"div\", 29);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r10 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r10.filtered);\n  }\n}\nfunction TraceabilityListComponent_div_41_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 21)(1, \"div\", 22)(2, \"h2\", 23);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"span\", 24);\n    i0.ɵɵtext(5, \"Geo data is logged server-side for anti-counterfeit surveillance.\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(6, TraceabilityListComponent_div_41_div_6_Template, 2, 0, \"div\", 25);\n    i0.ɵɵtemplate(7, TraceabilityListComponent_div_41_div_7_Template, 2, 1, \"div\", 26);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r5 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"Certified Products (\", ctx_r5.filtered.length, \")\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.filtered.length === 0);\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", ctx_r5.filtered.length > 0);\n  }\n}\nexport let TraceabilityListComponent = /*#__PURE__*/(() => {\n  class TraceabilityListComponent {\n    constructor(api, router) {\n      this.api = api;\n      this.router = router;\n      this.products = [];\n      this.filtered = [];\n      this.categories = [];\n      this.countries = [];\n      this.standards = [];\n      this.search = new FormControl('');\n      this.categoryFilter = '';\n      this.countryFilter = '';\n      this.standardFilter = '';\n      this.loading = false;\n      this.error = '';\n      this.destroy$ = new Subject();\n      this.geoHeaders = {};\n    }\n    ngOnInit() {\n      this.tryCollectGeo();\n      this.search.valueChanges.pipe(debounceTime(250), distinctUntilChanged(), takeUntil(this.destroy$)).subscribe(() => {\n        this.applyFilters();\n      });\n      this.load();\n    }\n    ngOnDestroy() {\n      this.destroy$.next();\n      this.destroy$.complete();\n    }\n    load() {\n      this.loading = true;\n      this.error = '';\n      this.api.getProducts({\n        search: this.search.value || undefined,\n        category: this.categoryFilter || undefined,\n        country: this.countryFilter || undefined,\n        standard: this.standardFilter || undefined\n      }, this.geoHeaders).pipe(takeUntil(this.destroy$)).subscribe({\n        next: data => {\n          this.products = data;\n          this.filtered = data;\n          this.extractFilters(data);\n          this.loading = false;\n        },\n        error: err => {\n          this.error = err.error?.message || 'Unable to load traceability directory.';\n          this.products = [];\n          this.filtered = [];\n          this.loading = false;\n        }\n      });\n    }\n    applyFilters() {\n      const term = (this.search.value || '').toString().toLowerCase();\n      this.filtered = this.products.filter(p => {\n        const matchesSearch = !term || p.cocNumber?.toLowerCase().includes(term) || p.productName?.toLowerCase().includes(term) || p.brand?.toLowerCase().includes(term) || p.standards?.some(s => s?.toLowerCase().includes(term));\n        const matchesCategory = !this.categoryFilter || p.category === this.categoryFilter;\n        const matchesCountry = !this.countryFilter || p.countryOfOrigin === this.countryFilter;\n        const matchesStandard = !this.standardFilter || p.standards?.includes(this.standardFilter);\n        return matchesSearch && matchesCategory && matchesCountry && matchesStandard;\n      });\n    }\n    extractFilters(data) {\n      this.categories = Array.from(new Set(data.map(p => p.category).filter(Boolean)));\n      this.countries = Array.from(new Set(data.map(p => p.countryOfOrigin).filter(Boolean)));\n      const standards = data.flatMap(p => p.standards || []);\n      this.standards = Array.from(new Set(standards));\n    }\n    clearFilters() {\n      this.search.setValue('');\n      this.categoryFilter = '';\n      this.countryFilter = '';\n      this.standardFilter = '';\n      this.applyFilters();\n    }\n    isExpired(expiry) {\n      if (!expiry) return false;\n      return new Date(expiry) < new Date();\n    }\n    formatDate(dateString) {\n      if (!dateString) return 'N/A';\n      const date = new Date(dateString);\n      return date.toLocaleDateString();\n    }\n    viewProduct(product) {\n      this.router.navigate(['/traceability/product', product.id]);\n    }\n    tryCollectGeo() {\n      if (!navigator?.geolocation) return;\n      navigator.geolocation.getCurrentPosition(pos => {\n        this.geoHeaders = {\n          lat: pos.coords.latitude,\n          lon: pos.coords.longitude\n        };\n      }, () => {\n        this.geoHeaders = {};\n      }, {\n        maximumAge: 300000,\n        timeout: 3000\n      });\n    }\n    static {\n      this.ɵfac = function TraceabilityListComponent_Factory(t) {\n        return new (t || TraceabilityListComponent)(i0.ɵɵdirectiveInject(i1.TraceabilityPublicService), i0.ɵɵdirectiveInject(i2.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: TraceabilityListComponent,\n        selectors: [[\"app-traceability-list\"]],\n        decls: 42,\n        vars: 10,\n        consts: [[1, \"max-w-6xl\", \"mx-auto\", \"py-8\", \"px-4\"], [1, \"mb-6\"], [1, \"text-3xl\", \"font-bold\", \"text-slate-900\"], [1, \"text-slate-600\", \"mt-1\"], [1, \"bg-white\", \"border\", \"border-slate-200\", \"rounded-xl\", \"shadow-sm\", \"p-4\", \"mb-4\"], [1, \"grid\", \"gap-3\", \"md:grid-cols-4\"], [1, \"md:col-span-2\"], [1, \"text-sm\", \"font-semibold\", \"text-slate-700\", \"mb-1\", \"block\"], [\"placeholder\", \"COC number, product, brand, standard...\", 1, \"w-full\", \"border\", \"border-slate-300\", \"rounded-lg\", \"px-3\", \"py-2\", \"text-sm\", \"focus:border-blue-600\", \"focus:outline-none\", 3, \"formControl\"], [1, \"w-full\", \"border\", \"border-slate-300\", \"rounded-lg\", \"px-3\", \"py-2\", \"text-sm\", 3, \"ngModel\", \"ngModelChange\", \"change\"], [\"value\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [1, \"flex\", \"items-end\"], [1, \"w-full\", \"text-sm\", \"font-semibold\", \"text-slate-700\", \"bg-slate-100\", \"px-3\", \"py-2\", \"rounded-lg\", \"hover:bg-slate-200\", 3, \"click\"], [\"routerLink\", \"/traceability/verify\", 1, \"w-full\", \"text-center\", \"text-sm\", \"font-semibold\", \"text-white\", \"bg-blue-600\", \"px-3\", \"py-2\", \"rounded-lg\", \"hover:bg-blue-700\"], [\"class\", \"bg-white border border-slate-200 rounded-xl p-6 text-center\", 4, \"ngIf\"], [\"class\", \"bg-red-50 border border-red-200 rounded-xl p-4 text-red-800\", 4, \"ngIf\"], [\"class\", \"bg-white border border-slate-200 rounded-xl shadow-sm overflow-hidden\", 4, \"ngIf\"], [3, \"value\"], [1, \"bg-white\", \"border\", \"border-slate-200\", \"rounded-xl\", \"p-6\", \"text-center\"], [1, \"bg-red-50\", \"border\", \"border-red-200\", \"rounded-xl\", \"p-4\", \"text-red-800\"], [1, \"bg-white\", \"border\", \"border-slate-200\", \"rounded-xl\", \"shadow-sm\", \"overflow-hidden\"], [1, \"px-4\", \"py-3\", \"border-b\", \"border-slate-200\", \"flex\", \"items-center\", \"justify-between\"], [1, \"font-semibold\", \"text-slate-900\"], [1, \"text-xs\", \"text-slate-500\"], [\"class\", \"p-6 text-sm text-slate-600\", 4, \"ngIf\"], [\"class\", \"divide-y divide-slate-200\", 4, \"ngIf\"], [1, \"p-6\", \"text-sm\", \"text-slate-600\"], [1, \"divide-y\", \"divide-slate-200\"], [\"class\", \"flex flex-col md:flex-row md:items-center md:justify-between px-4 py-3 hover:bg-slate-50 transition\", 4, \"ngFor\", \"ngForOf\"], [1, \"flex\", \"flex-col\", \"md:flex-row\", \"md:items-center\", \"md:justify-between\", \"px-4\", \"py-3\", \"hover:bg-slate-50\", \"transition\"], [1, \"space-y-1\"], [1, \"flex\", \"items-center\", \"gap-2\"], [1, \"font-mono\", \"text-blue-700\", \"text-sm\", \"font-semibold\"], [1, \"text-sm\", \"text-slate-600\"], [1, \"flex\", \"flex-wrap\", \"gap-1\"], [\"class\", \"bg-blue-50 text-blue-700 text-xs px-2 py-1 rounded\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"text-red-600 font-semibold\", 4, \"ngIf\"], [1, \"mt-3\", \"md:mt-0\", \"flex\", \"items-center\", \"gap-2\"], [1, \"text-sm\", \"font-semibold\", \"text-blue-700\", \"hover:underline\", 3, \"routerLink\"], [1, \"text-sm\", \"text-slate-700\", \"hover:underline\", 3, \"routerLink\", \"queryParams\"], [1, \"bg-blue-50\", \"text-blue-700\", \"text-xs\", \"px-2\", \"py-1\", \"rounded\"], [1, \"text-red-600\", \"font-semibold\"]],\n        template: function TraceabilityListComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1)(2, \"h1\", 2);\n            i0.ɵɵtext(3, \"Product Traceability & Verification\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(4, \"p\", 3);\n            i0.ɵɵtext(5, \" Public directory of certified products with QR-enabled Certificate of Conformity (COC) checks. \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(6, \"div\", 4)(7, \"div\", 5)(8, \"div\", 6)(9, \"label\", 7);\n            i0.ɵɵtext(10, \"Search\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(11, \"input\", 8);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"div\")(13, \"label\", 7);\n            i0.ɵɵtext(14, \"Category\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"select\", 9);\n            i0.ɵɵlistener(\"ngModelChange\", function TraceabilityListComponent_Template_select_ngModelChange_15_listener($event) {\n              return ctx.categoryFilter = $event;\n            })(\"change\", function TraceabilityListComponent_Template_select_change_15_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementStart(16, \"option\", 10);\n            i0.ɵɵtext(17, \"All\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(18, TraceabilityListComponent_option_18_Template, 2, 2, \"option\", 11);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(19, \"div\")(20, \"label\", 7);\n            i0.ɵɵtext(21, \"Origin Country\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(22, \"select\", 9);\n            i0.ɵɵlistener(\"ngModelChange\", function TraceabilityListComponent_Template_select_ngModelChange_22_listener($event) {\n              return ctx.countryFilter = $event;\n            })(\"change\", function TraceabilityListComponent_Template_select_change_22_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementStart(23, \"option\", 10);\n            i0.ɵɵtext(24, \"All\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(25, TraceabilityListComponent_option_25_Template, 2, 2, \"option\", 11);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(26, \"div\")(27, \"label\", 7);\n            i0.ɵɵtext(28, \"Standard\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(29, \"select\", 9);\n            i0.ɵɵlistener(\"ngModelChange\", function TraceabilityListComponent_Template_select_ngModelChange_29_listener($event) {\n              return ctx.standardFilter = $event;\n            })(\"change\", function TraceabilityListComponent_Template_select_change_29_listener() {\n              return ctx.applyFilters();\n            });\n            i0.ɵɵelementStart(30, \"option\", 10);\n            i0.ɵɵtext(31, \"All\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(32, TraceabilityListComponent_option_32_Template, 2, 2, \"option\", 11);\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(33, \"div\", 12)(34, \"button\", 13);\n            i0.ɵɵlistener(\"click\", function TraceabilityListComponent_Template_button_click_34_listener() {\n              return ctx.clearFilters();\n            });\n            i0.ɵɵtext(35, \" Clear filters \");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelementStart(36, \"div\", 12)(37, \"a\", 14);\n            i0.ɵɵtext(38, \" Scan / verify token \");\n            i0.ɵɵelementEnd()()()();\n            i0.ɵɵtemplate(39, TraceabilityListComponent_div_39_Template, 2, 0, \"div\", 15);\n            i0.ɵɵtemplate(40, TraceabilityListComponent_div_40_Template, 2, 1, \"div\", 16);\n            i0.ɵɵtemplate(41, TraceabilityListComponent_div_41_Template, 8, 3, \"div\", 17);\n            i0.ɵɵelementEnd();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(11);\n            i0.ɵɵproperty(\"formControl\", ctx.search);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngModel\", ctx.categoryFilter);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.categories);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngModel\", ctx.countryFilter);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.countries);\n            i0.ɵɵadvance(4);\n            i0.ɵɵproperty(\"ngModel\", ctx.standardFilter);\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"ngForOf\", ctx.standards);\n            i0.ɵɵadvance(7);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", ctx.error);\n            i0.ɵɵadvance(1);\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading);\n          }\n        },\n        dependencies: [i3.NgForOf, i3.NgIf, i4.NgSelectOption, i4.ɵNgSelectMultipleOption, i4.DefaultValueAccessor, i4.SelectControlValueAccessor, i4.NgControlStatus, i4.NgModel, i4.FormControlDirective, i2.RouterLink],\n        styles: [\"(()[_ngcontent-%COMP%]   =[_ngcontent-%COMP%] >  {// webpackBootstrap \\\"use strict\\\";})()[_ngcontent-%COMP%] ;{%BLOCK%}\"]\n      });\n    }\n  }\n  return TraceabilityListComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}